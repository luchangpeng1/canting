import{_ as Ge,L as Ke,a3 as Xe,S as Ze,ae as $e,l as el,P as ll,g as u,h as Z,U as he,o as Ve,j as tl,k as v,n as s,q as o,w as a,E as w,ap as ol,aw as nl,x as d,y as m,B as p,H as V,V as x,z as M,v as h,A as Ce,at as al,C as sl}from"./index-DxkRXB23.js";import{h as De}from"./request-HzNHAJSM.js";import{i as il}from"./index-CUeaqhHS.js";const rl={name:"MenuManagement",components:{Plus:Ke,Edit:Xe,Search:Ze,Delete:$e,Location:el,Timer:ll},setup(){const E=[{id:1,name:"红烧肉",category:"热菜",price:15,image_url:"https://example.com/dishes/hongshaorou.jpg",stock:50,description:"经典红烧肉，肥而不腻"},{id:2,name:"清炒时蔬",category:"素菜",price:8,image_url:"https://example.com/dishes/qingcao.jpg",stock:100,description:"新鲜时令蔬菜"},{id:3,name:"番茄蛋汤",category:"汤品",price:6,image_url:"https://example.com/dishes/fanqiedantang.jpg",stock:80,description:"营养美味的番茄蛋汤"}],l=[{id:1,name:"中央食堂",floors:3,location:"校园中心区"},{id:2,name:"沁园餐厅",floors:2,location:"学生宿舍区"},{id:3,name:"馨园餐厅",floors:1,location:"教学区"},{id:4,name:"仲园餐厅",floors:2,location:"图书馆附近"},{id:5,name:"雅园餐厅",floors:1,location:"体育馆附近"},{id:6,name:"服务点",floors:1,location:"F区、A区"}],$=[{id:101,name:"一楼-大荤窗口",location:"中央食堂一楼左",operatingHours:"10:30-13:30, 16:30-19:00",canteen:"中央食堂"},{id:102,name:"一楼-特色炒菜",location:"中央食堂一楼右",operatingHours:"10:30-13:30, 16:30-19:00",canteen:"中央食堂"},{id:201,name:"一楼-快餐窗口",location:"沁园餐厅一楼",operatingHours:"10:30-13:30, 16:30-19:00",canteen:"沁园餐厅"}],e=[{id:1,window_id:101,date:"2024-03-17",dishes:[{id:1,name:"红烧肉",price:15,stock:50},{id:2,name:"清炒时蔬",price:8,stock:100}]},{id:2,window_id:102,date:"2024-03-17",dishes:[{id:3,name:"番茄蛋汤",price:6,stock:80}]}],I=u(new Date),O=u(""),q=u([]),k=u(null),f=u(!1),C=u(!1),ee=u(l),y=u(e),S=u($),A=u(E),b=u([]),D=u(!1),L=u(!1),N=u(""),g=u(""),j=["主食","大荤","小荤","素菜","汤品","特色炒菜","面食","饮品","水果","小吃"],F=Z({stock:0,dishId:null}),le=he(()=>{let t=S.value;return T.value&&(t=t.filter(i=>i.canteen===T.value)),O.value&&(t=t.filter(i=>i.id===O.value)),t=t.map(i=>({...i,editable:ve(i.id)})),t}),te=he(()=>A.value.filter(t=>{const i=t.name.toLowerCase().includes(N.value.toLowerCase()),_=!g.value||t.category===g.value;return i&&_})),Q=async t=>{try{await new Promise(i=>setTimeout(i,500)),y.value=e,f.value=e.length>0}catch{w.error("获取菜单数据失败")}},oe=()=>{},ne=t=>{if(!ve(t.id)){w.warning("您没有权限编辑此窗口的菜单");return}k.value=t,b.value=R(t.id),D.value=!0},R=t=>{const i=y.value.find(_=>_.window_id===t);return i?i.dishes:[]},ae=t=>{const i=t.filter(_=>!b.value.some(K=>K.id===_.id));b.value.push(...i)},se=t=>{const i=b.value.findIndex(_=>_.id===t.id);i>-1&&b.value.splice(i,1)},U=t=>{F.dishId=t.id,F.stock=t.stock,L.value=!0},ie=async()=>{try{C.value=!0,await W(F.dishId,F.stock),w.success("库存更新成功"),L.value=!1,await z()}catch{w.error("库存更新失败")}finally{C.value=!1}},Y=async()=>{try{C.value=!0,await de({window_id:k.value.id,date:I.value,dishes:b.value.map(t=>t.id)}),w.success("菜单保存成功"),D.value=!1,await z()}catch{w.error("菜单保存失败")}finally{C.value=!1}},J=async t=>{try{await ol.confirm(`确定要从菜单中移除 ${t.name} 吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await De.delete(`/admin/menus/${k.value.id}/dishes/${t.id}`),w.success("移除成功"),await z()}catch(i){i!=="cancel"&&w.error("移除失败")}},re=t=>t.getTime()<Date.now()-864e5,z=async()=>{try{C.value=!0;const t=await De.get("/admin/menus",{params:{date:I.value}});y.value=t.data}catch(t){console.error("获取菜单失败:",t),w.error("获取菜单数据失败，请稍后重试"),y.value=[]}finally{C.value=!1}},de=async t=>new Promise((i,_)=>{setTimeout(()=>{console.log("保存的菜单数据:",t),i({status:"success"})},1e3)}),W=async(t,i)=>new Promise((_,K)=>{setTimeout(()=>{console.log(`更新菜品${t}的库存为${i}`),_({status:"success"})},500)});Ve(()=>{S.value=$,A.value=E,y.value=e,Q(I.value)});const ce=()=>{k.value=null,b.value=[],D.value=!0},ue=t=>{const i=new Date(t),_=["周日","周一","周二","周三","周四","周五","周六"];return`${i.getFullYear()}年${i.getMonth()+1}月${i.getDate()}日 ${_[i.getDay()]}`},me=t=>({主食:"",热菜:"success",凉菜:"info",汤品:"warning",饮品:"danger"})[t]||"info",T=u(""),B=u(!1),n=u(null),r=u(1),c=u(null),H={中央食堂:{1:"/floor-plans/central-1f.png",2:"/floor-plans/central-2f.png",3:"/floor-plans/central-3f.png"},沁园餐厅:{1:"/floor-plans/qinyuan-1f.png",2:"/floor-plans/qinyuan-2f.png"},仲园餐厅:{1:"/floor-plans/zhongyuan-1f.png",2:"/floor-plans/zhongyuan-2f.png"},馨园餐厅:{1:"/floor-plans/xinyuan-1f.png"},雅园餐厅:{1:"/floor-plans/yayuan-1f.png"}},xe={101:{x:30,y:40},102:{x:60,y:35}},Me=t=>{n.value=t,r.value=1,B.value=!0},Se=()=>{var t;return n.value?((t=H[n.value.name])==null?void 0:t[r.value])||"default-floor-plan.png":""},Fe=()=>n.value?S.value.filter(t=>t.canteen===n.value.name&&He(t)===r.value):[],He=t=>{const i=t.location.match(/(\d+)楼/);return i?parseInt(i[1]):1},Ue=t=>{const i=xe[t.id]||{x:0,y:0};return{left:`${i.x}%`,top:`${i.y}%`}},We=t=>{c.value=t},Te=()=>{c.value=null},Pe=t=>`${t.name}
营业时间：${t.operatingHours}
当前状态：${Ie(t)?"营业中":"已打烊"}`,Ie=t=>{const i=new Date,_=i.getHours(),K=i.getMinutes(),X=_*60+K,[ke,ye]=t.operatingHours.split(",").map(Je=>{const[be,we]=Je.trim().split("-");return{start:parseInt(be.split(":")[0])*60+parseInt(be.split(":")[1]),end:parseInt(we.split(":")[0])*60+parseInt(we.split(":")[1])}});return X>=ke.start&&X<=ke.end||X>=ye.start&&X<=ye.end},pe=u(!1),fe=u(null);let G=null;const Ae=Z({中央食堂:{lunch:{start:"11:30",end:"12:30"},dinner:{start:"17:30",end:"18:30"}},沁园餐厅:{lunch:{start:"11:45",end:"12:45"},dinner:{start:"17:45",end:"18:45"}},馨园餐厅:{lunch:{start:"11:30",end:"12:30"},dinner:{start:"17:30",end:"18:30"}},仲园餐厅:{lunch:{start:"11:30",end:"12:30"},dinner:{start:"17:30",end:"18:30"}},雅园餐厅:{lunch:{start:"11:30",end:"12:30"},dinner:{start:"17:30",end:"18:30"}},服务点:{lunch:{start:"11:30",end:"12:30"},dinner:{start:"17:30",end:"18:30"}}}),Le=Z({crowdAlert:!0,crowdThreshold:80}),P=Z({中央食堂:{current:65,max:100},沁园餐厅:{current:45,max:100}}),je=()=>{pe.value=!0,nl(()=>{Ye()})},Ye=()=>{if(!fe.value)return;G=il(fe.value);const t={title:{text:"各餐厅就餐人数统计",left:"center"},tooltip:{trigger:"axis"},legend:{data:Object.keys(P),bottom:0},xAxis:{type:"category",data:["10:30","11:00","11:30","12:00","12:30","13:00","13:30"]},yAxis:{type:"value",name:"就餐人数"},series:Object.entries(P).map(([i,_])=>({name:i,type:"line",smooth:!0,data:ze()}))};G.setOption(t)},ze=()=>Array.from({length:7},()=>Math.floor(Math.random()*100)),Be=t=>{const i=P[t].current;return i>80?"danger":i>60?"warning":"success"},Ee=t=>{const i=P[t].current;return i>80?"非常拥挤":i>60?"较为拥挤":"空闲"},Oe=()=>{w.success("设置已保存"),pe.value=!1};let ge=null;const qe=()=>{ge=setInterval(()=>{Object.keys(P).forEach(t=>{P[t].current=Math.floor(Math.random()*100)})},5e3)};Ve(()=>{qe()}),tl(()=>{ge&&clearInterval(ge),G&&G.dispose()});const Ne=u("中央食堂"),Qe=sl(),Re=()=>{Qe.push("/admin/dishes")},_e=he(()=>{const t=localStorage.getItem("verifiedInfo");return t?JSON.parse(t):null}),ve=t=>_e.value?_e.value.window.id===t:!1;return{selectedDate:I,windowFilter:O,activeWindows:q,activeCanteen:Ne,currentWindow:k,isPublished:f,loading:C,menus:y,windows:S,dishes:A,selectedDishes:b,dialogVisible:D,stockDialogVisible:L,dishSearchQuery:N,dishCategoryFilter:g,categories:j,stockForm:F,filteredWindows:le,filteredAvailableDishes:te,handleDateChange:Q,handleFilter:oe,editWindowMenu:ne,getWindowDishes:R,handleSelectionChange:ae,removeSelectedDish:se,updateStock:U,saveStock:ie,saveWindowMenu:Y,removeDish:J,disabledDate:re,formatDate:ue,getCategoryType:me,showAddDialog:ce,canteens:ee,canteenFilter:T,floorPlanVisible:B,currentCanteen:n,currentFloor:r,hoveredWindow:c,showFloorPlan:Me,getCurrentFloorPlan:Se,getFloorWindows:Fe,getMarkerStyle:Ue,showWindowInfo:We,hideWindowInfo:Te,getWindowTooltip:Pe,peakHoursDialogVisible:pe,peakHoursChart:fe,peakHours:Ae,notificationSettings:Le,showPeakHoursDialog:je,getCrowdLevelType:Be,getCrowdLevelText:Ee,savePeakHours:Oe,goToDishManagement:Re,hasPermission:ve,userVerification:_e}}},dl={class:"menu-management"},cl={class:"top-actions"},ul={class:"left"},ml={class:"right"},pl={style:{float:"left"}},fl={style:{float:"right",color:"#8492a6","font-size":"13px"}},gl={class:"menu-content"},_l={class:"canteen-header"},vl={class:"card-header"},hl={class:"header-title"},kl={class:"window-menus"},yl={class:"window-menu"},bl={class:"menu-header"},wl={class:"menu-time"},Vl={class:"menu-actions"},Cl={class:"dish-info"},Dl={class:"price"},xl={class:"dialog-content"},Ml={class:"selected-dishes"},Sl={class:"dish-selector"},Fl={class:"selector-filters"},Hl={class:"floor-plan-container"},Ul={key:0,class:"floor-selector"},Wl={class:"floor-plan"},Tl={class:"floor-plan-wrapper"},Pl=["src"],Il=["onMouseenter"],Al={class:"peak-hours-container"},Ll={class:"chart-container"},jl={ref:"peakHoursChart",class:"peak-hours-chart"},Yl={class:"peak-hours-settings"},zl={class:"peak-periods"},Bl={class:"period-group"},El={class:"period-group"},Ol={class:"crowd-level"},ql={class:"notification-settings"};function Nl(E,l,$,e,I,O){var T,B;const q=d("Plus"),k=d("el-icon"),f=d("el-button"),C=d("el-date-picker"),ee=d("Timer"),y=d("el-option"),S=d("el-select"),A=d("el-option-group"),b=d("Location"),D=d("el-tag"),L=d("Edit"),N=d("el-image"),g=d("el-table-column"),j=d("el-table"),F=d("el-collapse-item"),le=d("el-collapse"),te=d("el-card"),Q=d("el-col"),oe=d("el-row"),ne=d("el-tab-pane"),R=d("el-tabs"),ae=d("Search"),se=d("el-input"),U=d("el-dialog"),ie=d("el-input-number"),Y=d("el-form-item"),J=d("el-form"),re=d("el-radio-button"),z=d("el-radio-group"),de=d("el-tooltip"),W=d("el-time-select"),ce=d("el-divider"),ue=d("el-switch"),me=d("el-slider");return m(),v("div",dl,[s("div",cl,[s("div",ul,[o(f,{type:"primary",onClick:e.showAddDialog},{default:a(()=>[o(k,null,{default:a(()=>[o(q)]),_:1}),l[19]||(l[19]=p("上传菜单 "))]),_:1},8,["onClick"]),o(C,{modelValue:e.selectedDate,"onUpdate:modelValue":l[0]||(l[0]=n=>e.selectedDate=n),type:"date",placeholder:"选择日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",onChange:e.handleDateChange,"disabled-date":e.disabledDate,class:"date-picker"},null,8,["modelValue","onChange","disabled-date"]),o(f,{type:"warning",plain:"",onClick:e.showPeakHoursDialog},{default:a(()=>[o(k,null,{default:a(()=>[o(ee)]),_:1}),l[20]||(l[20]=p(" 高峰时段管理 "))]),_:1},8,["onClick"]),o(f,{type:"primary",plain:"",onClick:e.goToDishManagement},{default:a(()=>[o(k,null,{default:a(()=>[o(q)]),_:1}),l[21]||(l[21]=p(" 管理菜品库 "))]),_:1},8,["onClick"])]),s("div",ml,[o(S,{modelValue:e.canteenFilter,"onUpdate:modelValue":l[1]||(l[1]=n=>e.canteenFilter=n),placeholder:"选择餐厅",clearable:"",onChange:e.handleFilter,class:"filter-item"},{default:a(()=>[(m(!0),v(V,null,x(e.canteens,n=>(m(),M(y,{key:n.id,label:n.name,value:n.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue","onChange"]),o(S,{modelValue:e.windowFilter,"onUpdate:modelValue":l[2]||(l[2]=n=>e.windowFilter=n),placeholder:"选择窗口",clearable:"",onChange:e.handleFilter,class:"filter-item"},{default:a(()=>[(m(!0),v(V,null,x(e.canteens,n=>(m(),M(A,{key:n.id,label:n.name},{default:a(()=>[(m(!0),v(V,null,x(e.windows.filter(r=>r.canteen===n.name),r=>(m(),M(y,{key:r.id,label:r.name,value:r.id},{default:a(()=>[s("span",pl,h(r.name),1),s("span",fl,h(r.location),1)]),_:2},1032,["label","value"]))),128))]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue","onChange"])])]),s("div",gl,[o(R,{modelValue:e.activeCanteen,"onUpdate:modelValue":l[4]||(l[4]=n=>e.activeCanteen=n),type:"card",class:"canteen-tabs"},{default:a(()=>[(m(!0),v(V,null,x(e.canteens,n=>(m(),M(ne,{key:n.id,label:n.name,name:n.name},{default:a(()=>[s("div",_l,[s("h3",null,h(n.name),1),o(f,{type:"primary",plain:"",size:"small",onClick:r=>e.showFloorPlan(n)},{default:a(()=>[o(k,null,{default:a(()=>[o(b)]),_:1}),l[22]||(l[22]=p(" 查看平面图 "))]),_:2},1032,["onClick"])]),o(oe,{gutter:20},{default:a(()=>[o(Q,{span:24},{default:a(()=>[o(te,{class:"menu-card"},{header:a(()=>[s("div",vl,[s("span",hl,h(e.formatDate(e.selectedDate||new Date))+" 菜单安排 ",1),o(D,{type:"success",effect:"dark",class:"status-tag"},{default:a(()=>[p(h(e.isPublished?"已发布":"未发布"),1)]),_:1})])]),default:a(()=>[s("div",kl,[o(le,{modelValue:e.activeWindows,"onUpdate:modelValue":l[3]||(l[3]=r=>e.activeWindows=r)},{default:a(()=>[(m(!0),v(V,null,x(e.filteredWindows,r=>(m(),M(F,{key:r.id,title:r.name,name:r.id},{default:a(()=>[s("div",yl,[s("div",bl,[s("div",wl,"营业时间："+h(r.operatingHours),1),s("div",Vl,[r.editable?(m(),M(f,{key:0,type:"primary",link:"",onClick:c=>e.editWindowMenu(r)},{default:a(()=>[o(k,null,{default:a(()=>[o(L)]),_:1}),l[23]||(l[23]=p("编辑菜单 "))]),_:2},1032,["onClick"])):Ce("",!0)])]),o(j,{data:e.getWindowDishes(r.id),style:{width:"100%"},"header-cell-style":{background:"#f5f7fa"}},{default:a(()=>[o(g,{prop:"name",label:"菜品名称"},{default:a(({row:c})=>[s("div",Cl,[o(N,{src:c.image_url,"preview-src-list":[c.image_url],class:"dish-image"},null,8,["src","preview-src-list"]),s("span",null,h(c.name),1)])]),_:1}),o(g,{prop:"category",label:"类别",width:"120"},{default:a(({row:c})=>[o(D,{size:"small",type:e.getCategoryType(c.category)},{default:a(()=>[p(h(c.category),1)]),_:2},1032,["type"])]),_:1}),o(g,{prop:"price",label:"价格",width:"120"},{default:a(({row:c})=>[s("span",Dl,"¥"+h(c.price),1)]),_:1}),o(g,{label:"库存状态",width:"120"},{default:a(({row:c})=>[o(D,{type:c.stock>10?"success":c.stock>0?"warning":"danger",size:"small"},{default:a(()=>[p(h(c.stock>0?`剩余${c.stock}份`:"已售罄"),1)]),_:2},1032,["type"])]),_:1}),o(g,{label:"操作",width:"150",fixed:"right"},{default:a(({row:c})=>[e.hasPermission(r.id)?(m(),v(V,{key:0},[o(f,{type:"primary",link:"",onClick:H=>e.updateStock(c)},{default:a(()=>l[24]||(l[24]=[p(" 更新库存 ")])),_:2},1032,["onClick"]),o(f,{type:"danger",link:"",onClick:H=>e.removeDish(c)},{default:a(()=>l[25]||(l[25]=[p(" 移除 ")])),_:2},1032,["onClick"])],64)):(m(),M(f,{key:1,type:"info",link:"",onClick:H=>E.viewDishDetails(c)},{default:a(()=>l[26]||(l[26]=[p(" 查看详情 ")])),_:2},1032,["onClick"]))]),_:2},1024)]),_:2},1032,["data"])])]),_:2},1032,["title","name"]))),128))]),_:1},8,["modelValue"])])]),_:1})]),_:1})]),_:1})]),_:2},1032,["label","name"]))),128))]),_:1},8,["modelValue"])]),o(U,{title:`编辑${((T=e.currentWindow)==null?void 0:T.name)||""}菜单`,modelValue:e.dialogVisible,"onUpdate:modelValue":l[8]||(l[8]=n=>e.dialogVisible=n),width:"60%"},{footer:a(()=>[o(f,{onClick:l[7]||(l[7]=n=>e.dialogVisible=!1)},{default:a(()=>l[30]||(l[30]=[p("取消")])),_:1}),o(f,{type:"primary",onClick:e.saveWindowMenu,loading:e.loading},{default:a(()=>l[31]||(l[31]=[p(" 保存菜单 ")])),_:1},8,["onClick","loading"])]),default:a(()=>[s("div",xl,[s("div",Ml,[l[28]||(l[28]=s("h4",null,"已选菜品",-1)),o(j,{data:e.selectedDishes,style:{width:"100%"}},{default:a(()=>[o(g,{prop:"name",label:"菜品名称"}),o(g,{prop:"category",label:"类别",width:"120"}),o(g,{prop:"price",label:"价格",width:"120"}),o(g,{label:"操作",width:"120"},{default:a(({row:n})=>[o(f,{type:"danger",link:"",onClick:r=>e.removeSelectedDish(n)},{default:a(()=>l[27]||(l[27]=[p(" 移除 ")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),s("div",Sl,[l[29]||(l[29]=s("h4",null,"添加菜品",-1)),s("div",Fl,[o(se,{modelValue:e.dishSearchQuery,"onUpdate:modelValue":l[5]||(l[5]=n=>e.dishSearchQuery=n),placeholder:"搜索菜品",clearable:"",class:"search-input"},{prefix:a(()=>[o(k,null,{default:a(()=>[o(ae)]),_:1})]),_:1},8,["modelValue"]),o(S,{modelValue:e.dishCategoryFilter,"onUpdate:modelValue":l[6]||(l[6]=n=>e.dishCategoryFilter=n),placeholder:"菜品类别",clearable:""},{default:a(()=>[(m(!0),v(V,null,x(e.categories,n=>(m(),M(y,{key:n,label:n,value:n},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),o(j,{data:e.filteredAvailableDishes,style:{width:"100%"},height:"300",onSelectionChange:e.handleSelectionChange},{default:a(()=>[o(g,{type:"selection",width:"55"}),o(g,{prop:"name",label:"菜品名称"}),o(g,{prop:"category",label:"类别",width:"120"}),o(g,{prop:"price",label:"价格",width:"120"})]),_:1},8,["data","onSelectionChange"])])])]),_:1},8,["title","modelValue"]),o(U,{title:"更新库存",modelValue:e.stockDialogVisible,"onUpdate:modelValue":l[11]||(l[11]=n=>e.stockDialogVisible=n),width:"400px"},{footer:a(()=>[o(f,{onClick:l[10]||(l[10]=n=>e.stockDialogVisible=!1)},{default:a(()=>l[32]||(l[32]=[p("取消")])),_:1}),o(f,{type:"primary",onClick:e.saveStock,loading:e.loading},{default:a(()=>l[33]||(l[33]=[p(" 确定 ")])),_:1},8,["onClick","loading"])]),default:a(()=>[o(J,{model:e.stockForm,"label-width":"80px"},{default:a(()=>[o(Y,{label:"当前库存"},{default:a(()=>[o(ie,{modelValue:e.stockForm.stock,"onUpdate:modelValue":l[9]||(l[9]=n=>e.stockForm.stock=n),min:0,max:999,"controls-position":"right"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),o(U,{title:`${((B=e.currentCanteen)==null?void 0:B.name)||""} 平面图`,modelValue:e.floorPlanVisible,"onUpdate:modelValue":l[14]||(l[14]=n=>e.floorPlanVisible=n),width:"80%",class:"floor-plan-dialog"},{default:a(()=>{var n;return[s("div",Hl,[((n=e.currentCanteen)==null?void 0:n.floors)>1?(m(),v("div",Ul,[o(z,{modelValue:e.currentFloor,"onUpdate:modelValue":l[12]||(l[12]=r=>e.currentFloor=r)},{default:a(()=>[(m(!0),v(V,null,x(e.currentCanteen.floors,r=>(m(),M(re,{key:r,label:r},{default:a(()=>[p(h(r)+"层 ",1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])])):Ce("",!0),s("div",Wl,[s("div",Tl,[s("img",{src:e.getCurrentFloorPlan(),class:"floor-plan-image"},null,8,Pl),(m(!0),v(V,null,x(e.getFloorWindows(),r=>{var c;return m(),v("div",{key:r.id,class:"window-marker",style:al(e.getMarkerStyle(r)),onMouseenter:H=>e.showWindowInfo(r),onMouseleave:l[13]||(l[13]=(...H)=>e.hideWindowInfo&&e.hideWindowInfo(...H))},[o(de,{content:e.getWindowTooltip(r),placement:"top",visible:((c=e.hoveredWindow)==null?void 0:c.id)===r.id},{default:a(()=>l[34]||(l[34]=[s("div",{class:"marker-dot"},null,-1)])),_:2},1032,["content","visible"])],44,Il)}),128))]),l[35]||(l[35]=s("div",{class:"floor-plan-legend"},[s("div",{class:"legend-item"},[s("span",{class:"legend-dot available"}),s("span",null,"营业中")]),s("div",{class:"legend-item"},[s("span",{class:"legend-dot closed"}),s("span",null,"已打烊")])],-1))])])]}),_:1},8,["title","modelValue"]),o(U,{title:"就餐高峰时段管理",modelValue:e.peakHoursDialogVisible,"onUpdate:modelValue":l[18]||(l[18]=n=>e.peakHoursDialogVisible=n),width:"60%"},{footer:a(()=>[o(f,{onClick:l[17]||(l[17]=n=>e.peakHoursDialogVisible=!1)},{default:a(()=>l[42]||(l[42]=[p("取消")])),_:1}),o(f,{type:"primary",onClick:e.savePeakHours},{default:a(()=>l[43]||(l[43]=[p("保存设置")])),_:1},8,["onClick"])]),default:a(()=>[s("div",Al,[s("div",Ll,[s("div",jl,null,512)]),s("div",Yl,[(m(!0),v(V,null,x(e.canteens,n=>(m(),v("div",{key:n.id,class:"canteen-peak-hours"},[s("h4",null,h(n.name),1),s("div",zl,[s("div",Bl,[l[36]||(l[36]=s("span",{class:"period-label"},"午餐高峰：",-1)),o(W,{modelValue:e.peakHours[n.name].lunch.start,"onUpdate:modelValue":r=>e.peakHours[n.name].lunch.start=r,start:"10:30",step:"00:15",end:"14:00",placeholder:"开始时间",class:"time-select"},null,8,["modelValue","onUpdate:modelValue"]),l[37]||(l[37]=s("span",null,"至",-1)),o(W,{modelValue:e.peakHours[n.name].lunch.end,"onUpdate:modelValue":r=>e.peakHours[n.name].lunch.end=r,start:"10:30",step:"00:15",end:"14:00",placeholder:"结束时间",class:"time-select"},null,8,["modelValue","onUpdate:modelValue"])]),s("div",El,[l[38]||(l[38]=s("span",{class:"period-label"},"晚餐高峰：",-1)),o(W,{modelValue:e.peakHours[n.name].dinner.start,"onUpdate:modelValue":r=>e.peakHours[n.name].dinner.start=r,start:"16:30",step:"00:15",end:"20:00",placeholder:"开始时间",class:"time-select"},null,8,["modelValue","onUpdate:modelValue"]),l[39]||(l[39]=s("span",null,"至",-1)),o(W,{modelValue:e.peakHours[n.name].dinner.end,"onUpdate:modelValue":r=>e.peakHours[n.name].dinner.end=r,start:"16:30",step:"00:15",end:"20:00",placeholder:"结束时间",class:"time-select"},null,8,["modelValue","onUpdate:modelValue"])]),s("div",Ol,[l[40]||(l[40]=s("span",{class:"period-label"},"当前拥��度：",-1)),o(D,{type:e.getCrowdLevelType(n.name)},{default:a(()=>[p(h(e.getCrowdLevelText(n.name)),1)]),_:2},1032,["type"])])])]))),128))]),s("div",ql,[o(ce,null,{default:a(()=>l[41]||(l[41]=[p("实时提醒设置")])),_:1}),o(J,{model:e.notificationSettings,"label-width":"120px"},{default:a(()=>[o(Y,{label:"拥挤度提醒"},{default:a(()=>[o(ue,{modelValue:e.notificationSettings.crowdAlert,"onUpdate:modelValue":l[15]||(l[15]=n=>e.notificationSettings.crowdAlert=n)},null,8,["modelValue"])]),_:1}),o(Y,{label:"提醒阈值"},{default:a(()=>[o(me,{modelValue:e.notificationSettings.crowdThreshold,"onUpdate:modelValue":l[16]||(l[16]=n=>e.notificationSettings.crowdThreshold=n),min:0,max:100,step:10,disabled:!e.notificationSettings.crowdAlert,"show-stops":""},null,8,["modelValue","disabled"])]),_:1})]),_:1},8,["model"])])])]),_:1},8,["modelValue"])])}const Gl=Ge(rl,[["render",Nl],["__scopeId","data-v-0b59fb25"]]);export{Gl as default};
