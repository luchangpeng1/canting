import{_ as X,al as G,U as J,aE as K,ao as Q,P as Z,g as p,V as L,ax as $,o as ee,k as C,q as n,w as l,n as u,af as te,z as f,aF as W,ad as ae,E as q,x as d,ag as ne,y as m,H as V,X as S,I as le,v as s,az as ie,B as r,A as M}from"./index-eMRJYRn7.js";const oe={1:[{id:101,name:"川湘菜窗口"},{id:102,name:"粤式炖汤"},{id:103,name:"新疆风味"},{id:104,name:"面食档口"}],2:[{id:201,name:"江浙小炒"},{id:202,name:"东北菜"},{id:203,name:"清真窗口"}],3:[{id:301,name:"特色炒饭"},{id:302,name:"火锅窗口"},{id:303,name:"小吃档口"}],4:[{id:401,name:"日韩料理"},{id:402,name:"西式快餐"},{id:403,name:"粉面档口"}],5:[{id:501,name:"创意简餐"},{id:502,name:"养生套餐"},{id:503,name:"水饺馄饨"}]},re=[{id:1,order_id:"ORD20240301001",canteen_id:1,canteen:"中央食堂",window_id:101,window:"川湘菜窗口",dishes:[{id:1,name:"宫保鸡丁",price:18,quantity:1},{id:2,name:"米饭",price:2,quantity:2}],total_amount:22,meal_type:"dine_in",status:"pending",created_at:"2024-03-01 12:30:00",remark:"不要太辣"},{id:2,order_id:"ORD20240301002",canteen_id:2,canteen:"沁园餐厅",window_id:201,window:"江浙小炒",dishes:[{id:3,name:"糖醋里脊",price:22,quantity:1},{id:4,name:"蛋炒饭",price:12,quantity:1}],total_amount:34,meal_type:"takeout",status:"accepted",created_at:"2024-03-01 12:35:00",remark:""},{id:3,order_id:"ORD20240301003",canteen_id:3,canteen:"馨园餐厅",window_id:302,window:"火锅窗口",dishes:[{id:5,name:"牛肉火锅",price:48,quantity:1},{id:6,name:"青菜拼盘",price:15,quantity:1}],total_amount:63,meal_type:"dine_in",status:"completed",created_at:"2024-03-01 13:00:00",remark:"多放香菜"},{id:4,order_id:"ORD20240301004",canteen_id:4,canteen:"仲园餐厅",window_id:401,window:"日韩料理",dishes:[{id:7,name:"寿司拼盘",price:35,quantity:1},{id:8,name:"味增汤",price:8,quantity:1}],total_amount:43,meal_type:"dine_in",status:"pending",created_at:"2024-03-01 13:15:00",remark:""},{id:5,order_id:"ORD20240301005",canteen_id:5,canteen:"雅园餐厅",window_id:502,window:"养生套餐",dishes:[{id:9,name:"五谷杂粮套餐",price:28,quantity:1},{id:10,name:"银耳汤",price:12,quantity:1}],total_amount:40,meal_type:"takeout",status:"accepted",created_at:"2024-03-01 13:30:00",remark:"汤要热的"}],de={name:"OrderManagement",components:{Download:G,ShoppingCart:J,Check:K,Close:Q,Timer:Z},setup(){const T=p(!1),a=p([]),B=p(1),t=p(20),R=p(0),v=p(""),b=p(""),g=p([]),x=p(!1),z=p(null),h=p(""),y=p([{title:"今日订单",value:0,type:"primary",icon:"ShoppingCart"},{title:"待处理",value:0,type:"warning",icon:"Timer"},{title:"已完成",value:0,type:"success",icon:"Check"},{title:"已取消",value:0,type:"danger",icon:"Close"}]),U=[{id:1,name:"中央食堂"},{id:2,name:"沁园餐厅"},{id:3,name:"馨园餐厅"},{id:4,name:"仲园餐厅"},{id:5,name:"雅园餐厅"}],Y=[{value:"pending",label:"待处理"},{value:"accepted",label:"已接单"},{value:"completed",label:"已完成"},{value:"cancelled",label:"已取消"},{value:"rejected",label:"已拒绝"}],k=[{text:"最近一周",value:()=>{const o=new Date,i=new Date;return i.setTime(i.getTime()-3600*1e3*24*7),[i,o]}},{text:"最近一个月",value:()=>{const o=new Date,i=new Date;return i.setTime(i.getTime()-3600*1e3*24*30),[i,o]}}],_=L(()=>v.value?oe[v.value]||[]:[]),O=L(()=>a.value.filter(o=>{let i=!0;if(v.value&&(i=i&&o.canteen_id===v.value),h.value&&(i=i&&o.window_id===h.value),b.value&&(i=i&&o.status===b.value),g.value&&g.value.length===2){const w=new Date(o.created_at);i=i&&w>=g.value[0]&&w<=g.value[1]}return i}));$(v,()=>{h.value=""});const j=o=>({pending:"warning",accepted:"primary",completed:"success",cancelled:"info",rejected:"danger"})[o]||"info",P=o=>({pending:"待处理",accepted:"已接单",completed:"已完成",cancelled:"已取消",rejected:"已拒绝"})[o]||o,F=o=>W(o).format("YYYY-MM-DD HH:mm:ss"),E=async(o,i)=>{try{const w=i==="accept"?"接单":"拒绝";await ae.confirm(`确定要${w}这个订单吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:i==="accept"?"success":"warning"}),await new Promise(c=>setTimeout(c,300)),o.status=i==="accept"?"accepted":"rejected",q.success(`订单已${w}`),x.value=!1}catch(w){w!=="cancel"&&q.error(`${i==="accept"?"接单":"拒绝"}失败`)}},D=()=>{q.success("订单导出功能在前端模式下不可用")},N=o=>{z.value=o,x.value=!0},H=o=>{t.value=o,e()},I=o=>{B.value=o,e()},e=async()=>{var o;T.value=!0;try{await new Promise(c=>setTimeout(c,500));let i=[...re];v.value&&(i=i.filter(c=>c.canteen_id===v.value)),b.value&&(i=i.filter(c=>c.status===b.value)),((o=g.value)==null?void 0:o.length)===2&&(i=i.filter(c=>{const A=new Date(c.created_at);return A>=g.value[0]&&A<=g.value[1]})),a.value=i,R.value=i.length;const w=W().format("YYYY-MM-DD");y.value[0].value=i.filter(c=>c.created_at.startsWith(w)).length,y.value[1].value=i.filter(c=>c.status==="pending").length,y.value[2].value=i.filter(c=>c.status==="completed").length,y.value[3].value=i.filter(c=>c.status==="cancelled").length}catch{q.error("获取订单列表失败")}finally{T.value=!1}};return ee(()=>{e()}),{loading:T,orders:a,currentPage:B,pageSize:t,total:R,canteenFilter:v,statusFilter:b,dateRange:g,detailDialogVisible:x,currentOrder:z,statistics:y,canteens:U,orderStatuses:Y,dateShortcuts:k,filteredOrders:O,getStatusType:j,getStatusText:P,formatDateTime:F,handleOrder:E,exportOrders:D,showOrderDetail:N,handleSizeChange:H,handleCurrentChange:I,windowFilter:h,windows:_}}},se={class:"order-management"},ce={class:"stat-content"},ue={class:"stat-value"},me={class:"stat-title"},_e={class:"toolbar"},pe={class:"filters"},ge={class:"actions"},fe={class:"order-dishes"},ve={class:"pagination"},ye={key:0,class:"order-detail"},we={class:"detail-section"},be={class:"detail-section"},he={class:"order-total"},ke={class:"total-amount"},De={class:"detail-section"},Ce={class:"remark"};function Oe(T,a,B,t,R,v){const b=d("el-icon"),g=d("el-card"),x=d("el-col"),z=d("el-row"),h=d("el-option"),y=d("el-select"),U=d("el-date-picker"),Y=d("Download"),k=d("el-button"),_=d("el-table-column"),O=d("el-tag"),j=d("el-tooltip"),P=d("el-button-group"),F=d("el-table"),E=d("el-pagination"),D=d("el-descriptions-item"),N=d("el-descriptions"),H=d("el-dialog"),I=ne("loading");return m(),C("div",se,[n(z,{gutter:20,class:"statistics"},{default:l(()=>[(m(!0),C(V,null,S(t.statistics,e=>(m(),f(x,{span:6,key:e.title},{default:l(()=>[n(g,{class:le(["stat-card",e.type])},{default:l(()=>[u("div",ce,[u("div",ue,s(e.value),1),u("div",me,s(e.title),1)]),n(b,{class:"stat-icon"},{default:l(()=>[(m(),f(ie(e.icon)))]),_:2},1024)]),_:2},1032,["class"])]),_:2},1024))),128))]),_:1}),u("div",_e,[u("div",pe,[n(y,{modelValue:t.canteenFilter,"onUpdate:modelValue":a[0]||(a[0]=e=>t.canteenFilter=e),placeholder:"选择餐厅",clearable:"",onChange:a[1]||(a[1]=e=>t.windowFilter="")},{default:l(()=>[(m(!0),C(V,null,S(t.canteens,e=>(m(),f(h,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),n(y,{modelValue:t.windowFilter,"onUpdate:modelValue":a[2]||(a[2]=e=>t.windowFilter=e),placeholder:"选择窗口",clearable:"",disabled:!t.canteenFilter},{default:l(()=>[(m(!0),C(V,null,S(t.windows,e=>(m(),f(h,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"]),n(y,{modelValue:t.statusFilter,"onUpdate:modelValue":a[3]||(a[3]=e=>t.statusFilter=e),placeholder:"订单状态",clearable:""},{default:l(()=>[(m(!0),C(V,null,S(t.orderStatuses,e=>(m(),f(h,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),n(U,{modelValue:t.dateRange,"onUpdate:modelValue":a[4]||(a[4]=e=>t.dateRange=e),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",shortcuts:t.dateShortcuts},null,8,["modelValue","shortcuts"])]),u("div",ge,[n(k,{type:"primary",onClick:t.exportOrders},{default:l(()=>[n(b,null,{default:l(()=>[n(Y)]),_:1}),a[10]||(a[10]=r("导出订单 "))]),_:1},8,["onClick"])])]),te((m(),f(F,{data:t.filteredOrders,style:{width:"100%"},border:"",stripe:""},{default:l(()=>[n(_,{prop:"order_id",label:"订单号",width:"160",fixed:""}),n(_,{prop:"canteen",label:"餐厅",width:"120"}),n(_,{prop:"window",label:"窗口",width:"120"}),n(_,{label:"订单内容","min-width":"200"},{default:l(({row:e})=>[u("div",fe,[(m(!0),C(V,null,S(e.dishes,o=>(m(),f(j,{key:o.id,content:`${o.name} x${o.quantity}`,placement:"top","show-after":500},{default:l(()=>[n(O,{size:"small",class:"dish-tag",style:{cursor:"pointer"}},{default:l(()=>[r(s(o.name)+" x"+s(o.quantity),1)]),_:2},1024)]),_:2},1032,["content"]))),128))])]),_:1}),n(_,{prop:"total_amount",label:"金额",width:"100",align:"right"},{default:l(({row:e})=>[r(" ¥"+s(e.total_amount.toFixed(2)),1)]),_:1}),n(_,{prop:"meal_type",label:"就餐方式",width:"90",align:"center"},{default:l(({row:e})=>[n(O,{type:e.meal_type==="dine_in"?"success":"warning",size:"small"},{default:l(()=>[r(s(e.meal_type==="dine_in"?"堂食":"打包"),1)]),_:2},1032,["type"])]),_:1}),n(_,{prop:"status",label:"状态",width:"90",align:"center"},{default:l(({row:e})=>[n(O,{type:t.getStatusType(e.status),size:"small"},{default:l(()=>[r(s(t.getStatusText(e.status)),1)]),_:2},1032,["type"])]),_:1}),n(_,{prop:"created_at",label:"下单时间",width:"150",align:"center"},{default:l(({row:e})=>[r(s(t.formatDateTime(e.created_at)),1)]),_:1}),n(_,{label:"操作",width:"150",fixed:"right",align:"center"},{default:l(({row:e})=>[n(P,null,{default:l(()=>[n(k,{link:"",type:"primary",onClick:o=>t.showOrderDetail(e),disabled:e.status==="completed"},{default:l(()=>a[11]||(a[11]=[r(" 查看 ")])),_:2},1032,["onClick","disabled"]),e.status==="pending"?(m(),f(k,{key:0,link:"",type:"success",onClick:o=>t.handleOrder(e,"accept")},{default:l(()=>a[12]||(a[12]=[r(" 接单 ")])),_:2},1032,["onClick"])):M("",!0),e.status==="pending"?(m(),f(k,{key:1,link:"",type:"danger",onClick:o=>t.handleOrder(e,"reject")},{default:l(()=>a[13]||(a[13]=[r(" 拒绝 ")])),_:2},1032,["onClick"])):M("",!0)]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[I,t.loading]]),u("div",ve,[n(E,{"current-page":t.currentPage,"onUpdate:currentPage":a[5]||(a[5]=e=>t.currentPage=e),"page-size":t.pageSize,"onUpdate:pageSize":a[6]||(a[6]=e=>t.pageSize=e),"page-sizes":[10,20,50,100],total:t.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:t.handleSizeChange,onCurrentChange:t.handleCurrentChange},null,8,["current-page","page-size","total","onSizeChange","onCurrentChange"])]),n(H,{title:"订单详情",modelValue:t.detailDialogVisible,"onUpdate:modelValue":a[9]||(a[9]=e=>t.detailDialogVisible=e),width:"600px"},{footer:l(()=>{var e;return[n(k,{onClick:a[7]||(a[7]=o=>t.detailDialogVisible=!1)},{default:l(()=>a[18]||(a[18]=[r("关闭")])),_:1}),((e=t.currentOrder)==null?void 0:e.status)==="pending"?(m(),f(k,{key:0,type:"primary",onClick:a[8]||(a[8]=o=>t.handleOrder(t.currentOrder,"accept"))},{default:l(()=>a[19]||(a[19]=[r(" 接单 ")])),_:1})):M("",!0)]}),default:l(()=>[t.currentOrder?(m(),C("div",ye,[u("div",we,[a[14]||(a[14]=u("h4",null,"基本信息",-1)),n(N,{column:2,border:""},{default:l(()=>[n(D,{label:"订单号"},{default:l(()=>[r(s(t.currentOrder.order_id),1)]),_:1}),n(D,{label:"下单时间"},{default:l(()=>[r(s(t.formatDateTime(t.currentOrder.created_at)),1)]),_:1}),n(D,{label:"餐厅"},{default:l(()=>[r(s(t.currentOrder.canteen),1)]),_:1}),n(D,{label:"窗口"},{default:l(()=>[r(s(t.currentOrder.window),1)]),_:1}),n(D,{label:"就餐方式"},{default:l(()=>[r(s(t.currentOrder.meal_type==="dine_in"?"堂食":"打包"),1)]),_:1}),n(D,{label:"订单状态"},{default:l(()=>[n(O,{type:t.getStatusType(t.currentOrder.status)},{default:l(()=>[r(s(t.getStatusText(t.currentOrder.status)),1)]),_:1},8,["type"])]),_:1})]),_:1})]),u("div",be,[a[16]||(a[16]=u("h4",null,"菜品信息",-1)),n(F,{data:t.currentOrder.dishes,border:""},{default:l(()=>[n(_,{prop:"name",label:"菜品名称"}),n(_,{prop:"price",label:"单价"},{default:l(({row:e})=>[r("¥"+s(e.price.toFixed(2)),1)]),_:1}),n(_,{prop:"quantity",label:"数量",width:"100"}),n(_,{label:"小计",width:"120"},{default:l(({row:e})=>[r(" ¥"+s((e.price*e.quantity).toFixed(2)),1)]),_:1})]),_:1},8,["data"]),u("div",he,[a[15]||(a[15]=r(" 总计：")),u("span",ke,"¥"+s(t.currentOrder.total_amount.toFixed(2)),1)])]),u("div",De,[a[17]||(a[17]=u("h4",null,"备注信息",-1)),u("p",Ce,s(t.currentOrder.remark||"无"),1)])])):M("",!0)]),_:1},8,["modelValue"])])}const Ve=X(de,[["render",Oe],["__scopeId","data-v-b4a26b7e"]]);export{Ve as default};
