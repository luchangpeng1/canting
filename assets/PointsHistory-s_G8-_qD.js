import{_ as V,ak as C,t as T,V as d,g as H,o as B,k as g,n as s,q as n,w as r,as as D,x as l,y as c,B as y,v as a,H as I,X as A,z as R,I as Y,A as P,aj as z}from"./index-1A1V_OG6.js";const j={name:"PointsHistory",components:{ArrowLeft:C,Trophy:T},setup(){const _=z(),t=d(()=>_.getters["user/userInfo"]),f=H([]),o=H("all"),p=H(!1),M=d(()=>{const e=t.value.points;return e>=1e3?"钻石会员":e>=501?"黄金会员":e>=101?"白银会员":"普通会员"}),h=d(()=>{const e=t.value.points;return e>=1e3?"85":e>=501?"90":e>=101?"95":"100"}),v=d(()=>{const e=t.value.points;return e>=1e3?100:e>=501?Math.floor((e-501)/5):e>=101?Math.floor((e-101)/4):Math.floor(e)}),b=d(()=>{const e=t.value.points;return e>=1e3?0:e>=501?1e3-e:e>=101?501-e:101-e}),k=d(()=>{const e=t.value.points;return e>=1e3?"1000+":e>=501?"501-1000":e>=101?"101-500":"0-100"}),w=d(()=>{const e=t.value.points;return e>=1e3?"":e>=501?"1000+":e>=101?"501-1000":"101-500"}),m=e=>`${e}%`,u=d(()=>o.value==="all"?f.value:f.value.filter(e=>e.type===o.value)),L=e=>D(e).format("YYYY-MM-DD HH:mm"),x=async()=>{try{p.value=!0;const e=await _.dispatch("user/getPointsHistory");f.value=e}catch(e){console.error("获取积分历史失败:",e)}finally{p.value=!1}};return B(()=>{x()}),{userInfo:t,filter:o,filteredHistory:u,getMemberLevel:M,getMemberDiscount:h,getLevelProgress:v,getNextLevelPoints:b,getCurrentLevelRange:k,getNextLevelRange:w,formatProgress:m,formatTime:L,loading:p}}},S={class:"points-history"},q={class:"page-header"},E={class:"overview-content"},F={class:"points-total"},U={class:"value"},X={class:"points-tips"},G={class:"member-level"},J={class:"value"},K={class:"level-discount"},O={class:"level-progress"},Q={class:"progress-labels"},W={class:"card-header"},Z={class:"timeline-wrapper"},$={class:"history-item"},ee={class:"history-content"},te={class:"description"},se={key:0,class:"empty-state"},oe={key:1,class:"loading-state"};function ne(_,t,f,o,p,M){const h=l("ArrowLeft"),v=l("el-icon"),b=l("el-button"),k=l("Trophy"),w=l("el-progress"),m=l("el-card"),u=l("el-radio-button"),L=l("el-radio-group"),x=l("el-timeline-item"),e=l("el-timeline"),N=l("el-skeleton");return c(),g("div",S,[s("div",q,[n(b,{class:"back-btn",link:"",onClick:t[0]||(t[0]=i=>_.$router.back())},{default:r(()=>[n(v,null,{default:r(()=>[n(h)]),_:1}),t[2]||(t[2]=y(" 返回 "))]),_:1}),t[3]||(t[3]=s("h2",{class:"page-title"},"积分记录",-1))]),n(m,{class:"points-overview"},{default:r(()=>[s("div",E,[s("div",F,[t[4]||(t[4]=s("div",{class:"label"},"当前积分",-1)),s("div",U,a(o.userInfo.points),1),s("div",X,[n(v,null,{default:r(()=>[n(k)]),_:1}),s("span",null,"距离下一等级还需 "+a(o.getNextLevelPoints)+" 分",1)])]),s("div",G,[t[5]||(t[5]=s("div",{class:"label"},"会员等级",-1)),s("div",J,a(o.getMemberLevel),1),s("div",K,"订单享"+a(o.getMemberDiscount)+"折",1)])]),s("div",O,[n(w,{percentage:o.getLevelProgress,format:o.formatProgress,"stroke-width":8,"show-text":!1},null,8,["percentage","format"]),s("div",Q,[s("span",null,a(o.getCurrentLevelRange),1),s("span",null,a(o.getNextLevelRange),1)])])]),_:1}),n(m,{class:"history-list"},{header:r(()=>[s("div",W,[t[9]||(t[9]=s("div",{class:"filter-label"},"筛选",-1)),n(L,{modelValue:o.filter,"onUpdate:modelValue":t[1]||(t[1]=i=>o.filter=i),size:"small"},{default:r(()=>[n(u,{value:"all"},{default:r(()=>t[6]||(t[6]=[y("全部")])),_:1}),n(u,{value:"earn"},{default:r(()=>t[7]||(t[7]=[y("获取")])),_:1}),n(u,{value:"exchange"},{default:r(()=>t[8]||(t[8]=[y("兑换")])),_:1})]),_:1},8,["modelValue"])])]),default:r(()=>[s("div",Z,[n(e,null,{default:r(()=>[(c(!0),g(I,null,A(o.filteredHistory,i=>(c(),R(x,{key:i.id,type:i.type==="earn"?"success":"warning",timestamp:o.formatTime(i.createTime),hollow:!0},{default:r(()=>[s("div",$,[s("div",ee,[s("div",te,a(i.description),1),s("div",{class:Y(["points",i.type])},a(i.type==="earn"?"+":"-")+a(Math.abs(i.points)),3)])])]),_:2},1032,["type","timestamp"]))),128))]),_:1}),o.filteredHistory.length===0?(c(),g("div",se," 暂无积分记录 ")):P("",!0),o.loading?(c(),g("div",oe,[n(N,{rows:3,animated:""})])):P("",!0)])]),_:1})])}const le=V(j,[["render",ne],["__scopeId","data-v-3b6ff768"]]);export{le as default};
