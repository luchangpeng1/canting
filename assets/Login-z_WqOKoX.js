import{_ as B,u as Q,s as z,m as A,d as G,a as W,b as j,p as O,l as Y,c as H,t as J,i as K,r as X,e as Z,f as $,g as b,h as ee,o as oe,j as le,k as R,n as o,q as l,w as n,T as se,v as c,x as i,y as p,z as T,A as w,B as q,C as ne,E as C,D as ae}from"./index-CjeFGtzt.js";import{h as te}from"./request-Coerp45x.js";const re=[{username:"student001",password:"123456",userType:"student",realName:"测试学生",verifiedInfo:{role:"student"}},{username:"admin001",password:"123456",userType:"admin",realName:"超级管理员",verifiedInfo:{role:"superadmin",permissions:["all"]}},{username:"window001",password:"123456",userType:"admin",realName:"窗口管理员",verifiedInfo:{role:"window_admin",canteen:{id:1,name:"中央食堂"},window:{id:101,name:"大荤窗口",floor:1,type:"大荤窗口",operatingHours:"10:30-13:30, 16:30-19:00"}}}],ie={name:"Login",components:{User:Q,Setting:z,Monitor:A,DataLine:G,Service:W,Shop:j,Promotion:O,Location:Y,School:H,Trophy:J,InfoFilled:K,Refresh:X,Message:Z,Lock:$},setup(){const S=ne(),e=b(null),h=b(!0),s=b(!1),u=ee({username:"",password:"",confirmPassword:"",userType:""}),P={username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:3,max:20,message:"长度在 3 到 20 个字符",trigger:"blur"},{pattern:/^[a-zA-Z0-9_]+$/,message:"只能包含字母、数字和下划线",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,max:20,message:"长度在 6 到 20 个字符",trigger:"blur"}],confirmPassword:[{required:!0,message:"请确认密码",trigger:"blur",validator:(a,d,v)=>{d!==u.password?v(new Error("两次输入的密码不一致")):v()}}],userType:[{required:!0,message:"请选择登录身份",trigger:"change"}]},L=()=>{h.value=!h.value,u.username="",u.password="",u.confirmPassword="",e.value&&e.value.clearValidate()},r=async a=>{try{s.value=!0;const d=re.find(v=>v.username===a.username&&v.userType===a.userType);if(d){if(d.password===a.password){const v={username:d.username,userType:d.userType,realName:d.realName,verifiedInfo:d.verifiedInfo||{role:d.userType==="admin"?"window_admin":"student",canteen:{id:1,name:"中央食堂"},window:{id:101,name:"大荤窗口"}}};localStorage.setItem("user",JSON.stringify(v)),localStorage.setItem("token","test-token"),C.success("登录成功"),d.userType==="admin"?ae()?S.push("/m/admin/orders"):S.push("/admin/dishes"):S.push("/student/home");return}C.error("密码错误");return}C.error("用户名或密码错误")}catch(d){C.error(d.message||"登录失败，请重试")}finally{s.value=!1}},f=async a=>{try{s.value=!0,(await te.post("/auth/register",{username:a.username,password:a.password,userType:a.userType})).code===200&&(C.success("注册成功，请登录"),h.value=!0,u.username="",u.password="",u.confirmPassword="",u.userType="")}catch(d){console.error("注册失败:",d),C.error(d.message||"注册失败，请重试")}finally{s.value=!1}},V=async()=>{if(e.value)try{await e.value.validate();const a={username:u.username,password:u.password,userType:u.userType};h.value?await r(a):await f(a)}catch(a){console.error("表单验证失败:",a)}},y=["智慧校园，美食相伴","科技创新，服务师生","便捷订餐，品质生活"],m=b(y[0]);oe(()=>{let a=0;setInterval(()=>{a=(a+1)%y.length,m.value=y[a]},3e3)});const _=b(!1),g=b(""),k=b("等待扫码");let x=null;const U=async()=>{_.value=!0,k.value="等待扫码";try{g.value="https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=WeChat_Login_GUET"}catch(a){console.error("显示二维码失败:",a)}},I=async()=>{clearInterval(x),k.value="等待扫码",await U()};return le(()=>{}),{formRef:e,isLogin:h,form:u,rules:P,loading:s,toggleMode:L,handleSubmit:V,currentSlogan:m,qrDialogVisible:_,qrCodeUrl:g,qrStatus:k,showQRCode:U,refreshQRCode:I}}},de={class:"login-container"},ue={class:"login-box"},me={class:"school-info"},ce={class:"mobile-login"},fe={class:"login-header"},pe={class:"subtitle"},_e={class:"select-option"},ge={class:"select-option"},ve={class:"select-option"},ye={class:"select-option"},we={class:"form-actions"},be={class:"toggle-mode"},he={key:0,class:"qr-login"},Le={class:"bottom-section"},Ve={class:"school-features"},ke={class:"feature-item"},Te={class:"feature-item"},qe={class:"feature-item"},Ce={class:"guet-features"},Ue={class:"feature-card"},Se={class:"feature-card"},xe={class:"feature-card"},Re={class:"slogan-container"},Ie={class:"login-header"},Pe={class:"subtitle"},Me={class:"select-option"},Ne={class:"select-option"},Ee={class:"select-option"},De={class:"select-option"},Fe={class:"form-actions"},Be={class:"toggle-mode"},Qe={key:0,class:"qr-login"},ze={class:"footer"},Ae={class:"footer-content"},Ge={class:"qr-container"},We={class:"qr-wrapper"},je=["src"],Oe={class:"qr-overlay"},Ye={class:"qr-status"},He={class:"qr-help"};function Je(S,e,h,s,u,P){const L=i("User"),r=i("el-icon"),f=i("el-option"),V=i("Setting"),y=i("el-select"),m=i("el-form-item"),_=i("el-input"),g=i("el-button"),k=i("el-form"),x=i("Promotion"),U=i("el-card"),I=i("Monitor"),a=i("DataLine"),d=i("Service"),v=i("Location"),M=i("School"),N=i("Trophy"),E=i("Refresh"),D=i("InfoFilled"),F=i("el-dialog");return p(),R("div",de,[e[38]||(e[38]=o("div",{class:"bg-decoration"},[o("div",{class:"circle circle-1"}),o("div",{class:"circle circle-2"}),o("div",{class:"circle circle-3"})],-1)),o("div",ue,[o("div",me,[e[27]||(e[27]=o("div",{class:"top-section"},[o("img",{src:"https://ts1.cn.mm.bing.net/th/id/R-C.01105e6f89184c277c662f33cd977751?rik=yt%2btmFKbjD8EVg&riu=http%3a%2f%2ftqedu.net%2fUploadFiles%2f2020%2f12%2f202012101555445729.png&ehk=%2fViGN%2b4wOxRaLLnLMUSFsczf60lAW2Ycm8qzXmB7MWQ%3d&risl=&pid=ImgRaw&r=0",alt:"桂林电子科技大学",class:"school-logo"}),o("h1",{class:"school-name"},"桂林电子科技大学"),o("h2",{class:"system-name"},"智慧食堂管理系统")],-1)),o("div",ce,[l(U,{class:"login-card"},{default:n(()=>[o("div",fe,[o("h2",null,c(s.isLogin?"账号登录":"注册新用户"),1),o("p",pe,c(s.isLogin?"GUET智慧食堂":"欢迎加入智慧食堂"),1)]),l(k,{model:s.form,"label-position":"top",class:"login-form",rules:s.rules,ref:"formRef"},{default:n(()=>[s.isLogin?(p(),T(m,{key:0,label:"登录身份",prop:"userType"},{default:n(()=>[l(y,{modelValue:s.form.userType,"onUpdate:modelValue":e[0]||(e[0]=t=>s.form.userType=t),placeholder:"请选择登录身份",class:"user-type-select"},{default:n(()=>[l(f,{label:"学生",value:"student"},{default:n(()=>[o("div",_e,[l(r,null,{default:n(()=>[l(L)]),_:1}),e[11]||(e[11]=o("span",null,"学生",-1))])]),_:1}),l(f,{label:"食堂管理员",value:"admin"},{default:n(()=>[o("div",ge,[l(r,null,{default:n(()=>[l(V)]),_:1}),e[12]||(e[12]=o("span",null,"食堂管理员",-1))])]),_:1})]),_:1},8,["modelValue"])]),_:1})):w("",!0),s.isLogin?w("",!0):(p(),T(m,{key:1,label:"选择身份",prop:"userType"},{default:n(()=>[l(y,{modelValue:s.form.userType,"onUpdate:modelValue":e[1]||(e[1]=t=>s.form.userType=t),placeholder:"请选择您的身份",class:"user-type-select"},{default:n(()=>[l(f,{label:"学生",value:"student"},{default:n(()=>[o("div",ve,[l(r,null,{default:n(()=>[l(L)]),_:1}),e[13]||(e[13]=o("span",null,"学生",-1))])]),_:1}),l(f,{label:"食堂管理员",value:"admin"},{default:n(()=>[o("div",ye,[l(r,null,{default:n(()=>[l(V)]),_:1}),e[14]||(e[14]=o("span",null,"食堂管理员",-1))])]),_:1})]),_:1},8,["modelValue"])]),_:1})),l(m,{label:s.isLogin?"学号/工号":"请输入学号/工号",prop:"username"},{default:n(()=>[l(_,{modelValue:s.form.username,"onUpdate:modelValue":e[2]||(e[2]=t=>s.form.username=t),placeholder:s.isLogin?"请输入学号/工号":"学号为8位数字，工号为5位数字","prefix-icon":"User"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),l(m,{label:s.isLogin?"密码":"设置密码",prop:"password"},{default:n(()=>[l(_,{modelValue:s.form.password,"onUpdate:modelValue":e[3]||(e[3]=t=>s.form.password=t),type:"password",placeholder:s.isLogin?"请输入密码":"密码长度不少于6位","prefix-icon":"Lock","show-password":""},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),s.isLogin?w("",!0):(p(),T(m,{key:2,label:"确认密码",prop:"confirmPassword"},{default:n(()=>[l(_,{modelValue:s.form.confirmPassword,"onUpdate:modelValue":e[4]||(e[4]=t=>s.form.confirmPassword=t),type:"password",placeholder:"请再次输入密码","prefix-icon":"Lock","show-password":""},null,8,["modelValue"])]),_:1})),o("div",we,[l(g,{type:"primary",onClick:s.handleSubmit,loading:s.loading,class:"submit-btn"},{default:n(()=>[q(c(s.isLogin?"登 录":"注 册"),1)]),_:1},8,["onClick","loading"]),o("div",be,[l(g,{link:"",onClick:s.toggleMode,class:"toggle-btn"},{default:n(()=>[q(c(s.isLogin?"没有账号？去注册":"已有账号？去登录"),1)]),_:1},8,["onClick"])])])]),_:1},8,["model","rules"]),s.isLogin?(p(),R("div",he,[e[16]||(e[16]=o("div",{class:"divider"},[o("span",null,"或")],-1)),l(g,{class:"qr-btn",plain:"",onClick:s.showQRCode},{default:n(()=>[l(r,null,{default:n(()=>[l(x)]),_:1}),e[15]||(e[15]=q(" 扫码登录 "))]),_:1},8,["onClick"])])):w("",!0)]),_:1})]),o("div",Le,[o("div",Ve,[o("div",ke,[l(r,null,{default:n(()=>[l(I)]),_:1}),e[17]||(e[17]=o("span",null,"信息化管理",-1))]),o("div",Te,[l(r,null,{default:n(()=>[l(a)]),_:1}),e[18]||(e[18]=o("span",null,"智能分析",-1))]),o("div",qe,[l(r,null,{default:n(()=>[l(d)]),_:1}),e[19]||(e[19]=o("span",null,"便捷服务",-1))])]),o("div",Ce,[o("div",Ue,[l(r,null,{default:n(()=>[l(v)]),_:1}),e[20]||(e[20]=o("span",null,"金鸡岭校区",-1)),e[21]||(e[21]=o("small",null,"桂林市七星区金鸡路1号",-1))]),o("div",Se,[l(r,null,{default:n(()=>[l(M)]),_:1}),e[22]||(e[22]=o("span",null,"花江校区",-1)),e[23]||(e[23]=o("small",null,"灵川县",-1))]),o("div",xe,[l(r,null,{default:n(()=>[l(N)]),_:1}),e[24]||(e[24]=o("span",null,"双一流建设高校",-1)),e[25]||(e[25]=o("small",null,"电子信息特色鲜明",-1))])]),e[26]||(e[26]=o("div",{class:"school-motto"},[o("h3",null,"厚德、博学、求是、创新")],-1)),o("div",Re,[l(se,{name:"fade",mode:"out-in"},{default:n(()=>[(p(),R("p",{key:s.currentSlogan,class:"slogan"},c(s.currentSlogan),1))]),_:1})])])]),l(U,{class:"login-card"},{default:n(()=>[o("div",Ie,[o("h2",null,c(s.isLogin?"账号登录":"注册新用户"),1),o("p",Pe,c(s.isLogin?"GUET智慧食堂":"欢迎加入智慧食堂"),1)]),l(k,{model:s.form,"label-position":"top",class:"login-form",rules:s.rules,ref:"formRef"},{default:n(()=>[s.isLogin?(p(),T(m,{key:0,label:"登录身份",prop:"userType"},{default:n(()=>[l(y,{modelValue:s.form.userType,"onUpdate:modelValue":e[5]||(e[5]=t=>s.form.userType=t),placeholder:"请选择登录身份",class:"user-type-select"},{default:n(()=>[l(f,{label:"学生",value:"student"},{default:n(()=>[o("div",Me,[l(r,null,{default:n(()=>[l(L)]),_:1}),e[28]||(e[28]=o("span",null,"学生",-1))])]),_:1}),l(f,{label:"食堂管理员",value:"admin"},{default:n(()=>[o("div",Ne,[l(r,null,{default:n(()=>[l(V)]),_:1}),e[29]||(e[29]=o("span",null,"食堂管理员",-1))])]),_:1})]),_:1},8,["modelValue"])]),_:1})):w("",!0),s.isLogin?w("",!0):(p(),T(m,{key:1,label:"选择身份",prop:"userType"},{default:n(()=>[l(y,{modelValue:s.form.userType,"onUpdate:modelValue":e[6]||(e[6]=t=>s.form.userType=t),placeholder:"请选择您的身份",class:"user-type-select"},{default:n(()=>[l(f,{label:"学生",value:"student"},{default:n(()=>[o("div",Ee,[l(r,null,{default:n(()=>[l(L)]),_:1}),e[30]||(e[30]=o("span",null,"学生",-1))])]),_:1}),l(f,{label:"食堂管理员",value:"admin"},{default:n(()=>[o("div",De,[l(r,null,{default:n(()=>[l(V)]),_:1}),e[31]||(e[31]=o("span",null,"食堂管理员",-1))])]),_:1})]),_:1},8,["modelValue"])]),_:1})),l(m,{label:s.isLogin?"学号/工号":"请输入学号/工号",prop:"username"},{default:n(()=>[l(_,{modelValue:s.form.username,"onUpdate:modelValue":e[7]||(e[7]=t=>s.form.username=t),placeholder:s.isLogin?"请输入学号/工号":"学号为8位数字，工号为5位数字","prefix-icon":"User"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),l(m,{label:s.isLogin?"密码":"设置密码",prop:"password"},{default:n(()=>[l(_,{modelValue:s.form.password,"onUpdate:modelValue":e[8]||(e[8]=t=>s.form.password=t),type:"password",placeholder:s.isLogin?"请输入密码":"密码长度不少于6位","prefix-icon":"Lock","show-password":""},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),s.isLogin?w("",!0):(p(),T(m,{key:2,label:"确认密码",prop:"confirmPassword"},{default:n(()=>[l(_,{modelValue:s.form.confirmPassword,"onUpdate:modelValue":e[9]||(e[9]=t=>s.form.confirmPassword=t),type:"password",placeholder:"请再次输入密码","prefix-icon":"Lock","show-password":""},null,8,["modelValue"])]),_:1})),o("div",Fe,[l(g,{type:"primary",onClick:s.handleSubmit,loading:s.loading,class:"submit-btn"},{default:n(()=>[q(c(s.isLogin?"登 录":"注 册"),1)]),_:1},8,["onClick","loading"]),o("div",Be,[l(g,{link:"",onClick:s.toggleMode,class:"toggle-btn"},{default:n(()=>[q(c(s.isLogin?"没有账号？去注册":"已有账号？去登录"),1)]),_:1},8,["onClick"])])])]),_:1},8,["model","rules"]),s.isLogin?(p(),R("div",Qe,[e[33]||(e[33]=o("div",{class:"divider"},[o("span",null,"或")],-1)),l(g,{class:"qr-btn",plain:"",onClick:s.showQRCode},{default:n(()=>[l(r,null,{default:n(()=>[l(x)]),_:1}),e[32]||(e[32]=q(" 扫码登录 "))]),_:1},8,["onClick"])])):w("",!0)]),_:1})]),o("div",ze,[o("div",Ae,[o("p",null,"Copyright © "+c(new Date().getFullYear())+" 桂林电子科技大学",1),e[34]||(e[34]=o("p",null,"地址:桂林市七星区金鸡路1号",-1))])]),l(F,{modelValue:s.qrDialogVisible,"onUpdate:modelValue":e[10]||(e[10]=t=>s.qrDialogVisible=t),title:"微信扫码登录",width:"400px","align-center":"","show-close":!0,class:"qr-dialog","close-on-click-modal":!1},{default:n(()=>[o("div",Ge,[o("div",We,[o("img",{src:s.qrCodeUrl,alt:"微信扫码登录",class:"qr-image"},null,8,je),o("div",Oe,[l(r,{class:"refresh-icon",onClick:s.refreshQRCode},{default:n(()=>[l(E)]),_:1},8,["onClick"]),e[35]||(e[35]=o("span",null,"点击刷新二维码",-1))])]),e[37]||(e[37]=o("p",{class:"qr-tip"},"请使用微信扫一扫登录",-1)),o("p",Ye,c(s.qrStatus),1),o("div",He,[l(r,null,{default:n(()=>[l(D)]),_:1}),e[36]||(e[36]=o("span",null,"首次使用需要绑定微信账号",-1))])])]),_:1},8,["modelValue"])])}const Ze=B(ie,[["render",Je],["__scopeId","data-v-5d95a593"]]);export{Ze as default};
