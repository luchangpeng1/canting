import{_ as Y,C as Q,x as i,y as u,k as g,q as l,n,w as s,I as V,a1 as B,ak as X,aD as Z,aE as x,aF as ee,M as te,aG as le,aH as oe,g as f,Y as j,o as se,B as m,z as U,v as r,A as O,J,a3 as ne,E as h,af as ae}from"./index-CjeFGtzt.js";const ie={name:"BackHeader",props:{title:{type:String,required:!0}},setup(){const o=Q();return{goBack:()=>{o.back()}}}},re={class:"back-header"};function de(o,t,y,k,P,T){const C=i("el-page-header");return u(),g("div",re,[l(C,{title:y.title,onBack:k.goBack},null,8,["title","onBack"])])}const me=Y(ie,[["render",de],["__scopeId","data-v-5f938278"]]),ue={name:"RecommendationSquare",components:{Edit:X,CaretTop:Z,ChatDotRound:x,Share:ee,Plus:te,CircleCheckFilled:le,WarningFilled:oe,BackHeader:me},setup(){const o=f([]),t=f(!1),y=f(!1),k=f(""),P=f(""),T=f(""),C=f("latest"),v=f(!1),b=f(0),c=f(null),d=f({type:"recommend",title:"",canteen:"",window:"",dish:"",content:"",images:[],price:0,rating:0}),$={type:[{required:!0,message:"请选择发布类型",trigger:"change"}],title:[{required:!0,message:"请输入标题",trigger:"blur"}],canteen:[{required:!0,message:"请选择餐厅",trigger:"change"}],window:[{required:!0,message:"请选择窗口",trigger:"change"}],dish:[{required:!0,message:"请输入菜品名称",trigger:"blur"}],content:[{required:!0,message:"请输入内容描述",trigger:"blur"}]},_=[{id:1,user:{name:"张三",avatar:""},type:"recommend",title:"中央食堂的红烧肉太好吃了！",canteen:"中央食堂",window:"特色炒菜",dish:"红烧肉",content:"今天中午去吃了红烧肉，肥而不腻，特别推荐！",images:[],createTime:"2024-03-20 12:30",likes:15,isLiked:!1,showComments:!1,comments:[{id:1,user:{name:"李四",avatar:""},content:"同意，我也觉得很好吃",time:"2024-03-20 12:35"}]}],D=f([{id:1,name:"中央食堂",windows:[{id:1,name:"特色炒菜"},{id:2,name:"面食档口"}]},{id:2,name:"沁园餐厅",windows:[{id:3,name:"盖浇饭窗口"},{id:4,name:"小炒窗口"}]}]),R=j(()=>{if(!d.value.canteen)return[];const e=D.value.find(a=>a.name===d.value.canteen);return e?e.windows:[]}),q=j(()=>{let e=[...o.value];switch(P.value&&(e=e.filter(a=>a.type===P.value)),T.value&&(e=e.filter(a=>a.canteen===T.value)),C.value){case"mostLiked":e.sort((a,w)=>w.likes-a.likes);break;case"mostComments":e.sort((a,w)=>w.comments.length-a.comments.length);break;default:e.sort((a,w)=>new Date(w.createTime)-new Date(a.createTime))}return e}),z=()=>{t.value=!0},S=e=>{d.value.images.push(e)},F=async()=>{y.value=!0;try{await new Promise(e=>setTimeout(e,1e3)),h.success("发布成功"),t.value=!1,d.value={type:"recommend",title:"",canteen:"",window:"",dish:"",content:"",images:[],price:0,rating:0}}catch{h.error("发布失败")}finally{y.value=!1}},I=e=>{e.isLiked=!e.isLiked,e.likes+=e.isLiked?1:-1},E=e=>{e.showComments=!e.showComments},M=async e=>{if(!k.value.trim()){h.warning("请输入评论内容");return}try{const a={id:Date.now(),user:{name:"当前用户",avatar:""},content:k.value,time:new Date().toLocaleString()};e.comments.push(a),k.value="",h.success("评论成功")}catch{h.error("评论失败")}},p=(e,a)=>{b.value=e,v.value=!0},A=e=>e===1?"single-image":e===2?"two-images":e===3?"three-images":"four-images",G=e=>{d.value.window=""},N=e=>{const a=e.type==="image/jpeg",w=e.type==="image/png",K=e.size/1024/1024<2;return!a&&!w?(h.error("只能上传 JPG 或 PNG 格式的图片!"),!1):K?d.value.images.length>=4?(h.warning("最多只能上传4张图片"),!1):!0:(h.error("图片大小不能超过 2MB!"),!1)},W=e=>{const a=d.value.images.indexOf(e);a!==-1&&d.value.images.splice(a,1)},H=()=>{ae.confirm("确定要取消发布吗？已输入的内容将会丢失","提示",{confirmButtonText:"确定",cancelButtonText:"继续编辑",type:"warning"}).then(()=>{t.value=!1,L()}).catch(()=>{})},L=()=>{c.value&&c.value.resetFields(),d.value={type:"recommend",title:"",canteen:"",window:"",dish:"",content:"",images:[],price:0,rating:0}};return se(()=>{o.value=_}),{posts:o,postDialogVisible:t,posting:y,postForm:d,commentText:k,canteens:D,filteredWindows:R,filterType:P,filterCanteen:T,sortBy:C,showPostDialog:z,handleImageChange:S,submitPost:F,toggleLike:I,showComments:E,submitComment:M,previewImage:p,getImageGridClass:A,filteredPosts:q,handleCanteenChange:G,beforeImageUpload:N,handleImageRemove:W,cancelPost:H,resetForm:L,postFormRef:c,postRules:$}}},ce=ue,pe={class:"recommendation-square"},fe={class:"post-action"},ge={class:"filter-bar"},ve={class:"posts-list"},_e={class:"post-header"},we={class:"user-info"},he={class:"user-detail"},ke={class:"username"},ye={class:"post-time"},Ce={class:"post-content"},be={class:"post-title"},Fe={class:"location-info"},Ve={class:"post-text"},Be={key:0,class:"post-images"},Pe={class:"post-actions"},Te=["onClick"],Ue=["onClick"],$e={class:"action-item"},De={key:0,class:"comments-section"},Ie={class:"comments-list"},Le={class:"comment-content"},Re={class:"comment-user"},qe={class:"comment-text"},ze={class:"comment-time"},Se={class:"comment-input"},Ee={class:"post-type-selector"},Me=["src"],Ae={class:"post-preview"},Ge={class:"preview-content"},Ne={class:"preview-tags"},We={class:"preview-text"},He={class:"dialog-footer"};function Je(o,t,y,k,P,T){const C=i("Edit"),v=i("el-icon"),b=i("el-button"),c=i("el-option"),d=i("el-select"),$=i("el-avatar"),_=i("el-tag"),D=i("el-image"),R=i("CaretTop"),q=i("ChatDotRound"),z=i("Share"),S=i("el-divider"),F=i("el-input"),I=i("el-card"),E=i("CircleCheckFilled"),M=i("WarningFilled"),p=i("el-form-item"),A=i("el-input-number"),G=i("el-rate"),N=i("Plus"),W=i("el-upload"),H=i("el-form"),L=i("el-dialog");return u(),g("div",pe,[n("div",fe,[l(b,{type:"primary",onClick:o.showPostDialog},{default:s(()=>[l(v,null,{default:s(()=>[l(C)]),_:1}),t[16]||(t[16]=m(" 发布推荐/避雷 "))]),_:1},8,["onClick"])]),n("div",ge,[l(d,{modelValue:o.filterType,"onUpdate:modelValue":t[0]||(t[0]=e=>o.filterType=e),placeholder:"帖子类型",class:"filter-item"},{default:s(()=>[l(c,{label:"全部",value:""}),l(c,{label:"推荐",value:"recommend"}),l(c,{label:"避雷",value:"warning"})]),_:1},8,["modelValue"]),l(d,{modelValue:o.filterCanteen,"onUpdate:modelValue":t[1]||(t[1]=e=>o.filterCanteen=e),placeholder:"选择餐厅",class:"filter-item"},{default:s(()=>[l(c,{label:"全部餐厅",value:""}),(u(!0),g(V,null,B(o.canteens,e=>(u(),U(c,{key:e.id,label:e.name,value:e.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),l(d,{modelValue:o.sortBy,"onUpdate:modelValue":t[2]||(t[2]=e=>o.sortBy=e),placeholder:"排序方式",class:"filter-item"},{default:s(()=>[l(c,{label:"最新发布",value:"latest"}),l(c,{label:"最多点赞",value:"mostLiked"}),l(c,{label:"最多评论",value:"mostComments"})]),_:1},8,["modelValue"])]),n("div",ve,[(u(!0),g(V,null,B(o.filteredPosts,e=>(u(),U(I,{key:e.id,class:"post-card"},{default:s(()=>[n("div",_e,[n("div",we,[l($,{size:40,src:e.user.avatar},{default:s(()=>[m(r(e.user.name.charAt(0)),1)]),_:2},1032,["src"]),n("div",he,[n("span",ke,r(e.user.name),1),n("span",ye,r(e.createTime),1)])]),l(_,{type:e.type==="recommend"?"success":"danger"},{default:s(()=>[m(r(e.type==="recommend"?"推荐":"避雷"),1)]),_:2},1032,["type"])]),n("div",Ce,[n("h3",be,r(e.title),1),n("div",Fe,[l(_,{size:"small"},{default:s(()=>[m(r(e.canteen),1)]),_:2},1024),l(_,{size:"small",type:"info"},{default:s(()=>[m(r(e.window),1)]),_:2},1024),l(_,{size:"small",type:"warning"},{default:s(()=>[m(r(e.dish),1)]),_:2},1024)]),n("p",Ve,r(e.content),1),e.images.length?(u(),g("div",Be,[(u(!0),g(V,null,B(e.images,(a,w)=>(u(),U(D,{key:w,src:a,"preview-src-list":e.images,class:"post-image"},null,8,["src","preview-src-list"]))),128))])):O("",!0)]),n("div",Pe,[n("div",{class:"action-item",onClick:a=>o.toggleLike(e)},[l(v,{class:J({active:e.isLiked})},{default:s(()=>[l(R)]),_:2},1032,["class"]),n("span",null,r(e.likes)+"赞",1)],8,Te),n("div",{class:"action-item",onClick:a=>o.showComments(e)},[l(v,null,{default:s(()=>[l(q)]),_:1}),n("span",null,r(e.comments.length)+"评论",1)],8,Ue),n("div",$e,[l(v,null,{default:s(()=>[l(z)]),_:1}),t[17]||(t[17]=n("span",null,"分享",-1))])]),e.showComments?(u(),g("div",De,[l(S,null,{default:s(()=>t[18]||(t[18]=[m("评论区")])),_:1}),n("div",Ie,[(u(!0),g(V,null,B(e.comments,a=>(u(),g("div",{key:a.id,class:"comment-item"},[l($,{size:32,src:a.user.avatar},{default:s(()=>[m(r(a.user.name.charAt(0)),1)]),_:2},1032,["src"]),n("div",Le,[n("div",Re,r(a.user.name),1),n("div",qe,r(a.content),1),n("div",ze,r(a.time),1)])]))),128))]),n("div",Se,[l(F,{modelValue:o.commentText,"onUpdate:modelValue":t[3]||(t[3]=a=>o.commentText=a),placeholder:"写下你的评论...",rows:2,type:"textarea"},null,8,["modelValue"]),l(b,{type:"primary",onClick:a=>o.submitComment(e)},{default:s(()=>t[19]||(t[19]=[m("发表评论")])),_:2},1032,["onClick"])])])):O("",!0)]),_:2},1024))),128))]),l(L,{title:"发布推荐/避雷",modelValue:o.postDialogVisible,"onUpdate:modelValue":t[15]||(t[15]=e=>o.postDialogVisible=e),width:"90%","close-on-click-modal":!1,class:"post-dialog"},{footer:s(()=>[n("div",He,[l(b,{onClick:o.cancelPost},{default:s(()=>t[26]||(t[26]=[m("取消")])),_:1},8,["onClick"]),l(b,{type:"primary",onClick:o.submitPost,loading:o.posting},{default:s(()=>t[27]||(t[27]=[m(" 发布 ")])),_:1},8,["onClick","loading"])])]),default:s(()=>[l(H,{model:o.postForm,rules:o.postRules,ref:"postFormRef","label-width":"80px",onSubmit:t[14]||(t[14]=ne(()=>{},["prevent"]))},{default:s(()=>[l(p,{label:"类型",prop:"type"},{default:s(()=>[n("div",Ee,[n("div",{class:J(["type-item",{active:o.postForm.type==="recommend"}]),onClick:t[4]||(t[4]=e=>o.postForm.type="recommend")},[l(v,null,{default:s(()=>[l(E)]),_:1}),t[20]||(t[20]=n("span",null,"推荐好物",-1)),t[21]||(t[21]=n("small",null,"分享美食发现",-1))],2),n("div",{class:J(["type-item",{active:o.postForm.type==="warning"}]),onClick:t[5]||(t[5]=e=>o.postForm.type="warning")},[l(v,null,{default:s(()=>[l(M)]),_:1}),t[22]||(t[22]=n("span",null,"避雷提醒",-1)),t[23]||(t[23]=n("small",null,"帮助他人避坑",-1))],2)])]),_:1}),l(p,{label:"标题",prop:"title"},{default:s(()=>[l(F,{modelValue:o.postForm.title,"onUpdate:modelValue":t[6]||(t[6]=e=>o.postForm.title=e),placeholder:"一句话描述你的体验（最多30字）",maxlength:"30","show-word-limit":""},null,8,["modelValue"])]),_:1}),l(p,{label:"餐厅",prop:"canteen"},{default:s(()=>[l(d,{modelValue:o.postForm.canteen,"onUpdate:modelValue":t[7]||(t[7]=e=>o.postForm.canteen=e),placeholder:"选择餐厅",filterable:"",onChange:o.handleCanteenChange},{default:s(()=>[(u(!0),g(V,null,B(o.canteens,e=>(u(),U(c,{key:e.id,label:e.name,value:e.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue","onChange"])]),_:1}),l(p,{label:"窗口",prop:"window"},{default:s(()=>[l(d,{modelValue:o.postForm.window,"onUpdate:modelValue":t[8]||(t[8]=e=>o.postForm.window=e),placeholder:"选择窗口",filterable:"",disabled:!o.postForm.canteen},{default:s(()=>[(u(!0),g(V,null,B(o.filteredWindows,e=>(u(),U(c,{key:e.id,label:e.name,value:e.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1}),l(p,{label:"菜品",prop:"dish"},{default:s(()=>[l(F,{modelValue:o.postForm.dish,"onUpdate:modelValue":t[9]||(t[9]=e=>o.postForm.dish=e),placeholder:"输入菜品名称",maxlength:"20","show-word-limit":""},null,8,["modelValue"])]),_:1}),l(p,{label:"价格"},{default:s(()=>[l(A,{modelValue:o.postForm.price,"onUpdate:modelValue":t[10]||(t[10]=e=>o.postForm.price=e),min:0,precision:2,step:.5},null,8,["modelValue"])]),_:1}),l(p,{label:"评分"},{default:s(()=>[l(G,{modelValue:o.postForm.rating,"onUpdate:modelValue":t[11]||(t[11]=e=>o.postForm.rating=e),colors:["#99A9BF","#F7BA2A","#FF9900"]},null,8,["modelValue"])]),_:1}),l(p,{label:"内容",prop:"content"},{default:s(()=>[l(F,{modelValue:o.postForm.content,"onUpdate:modelValue":t[12]||(t[12]=e=>o.postForm.content=e),type:"textarea",rows:4,placeholder:"详细描述你的体验...",maxlength:"500","show-word-limit":""},null,8,["modelValue"])]),_:1}),l(p,{label:"图片"},{default:s(()=>[l(W,{"file-list":o.postForm.images,"onUpdate:fileList":t[13]||(t[13]=e=>o.postForm.images=e),action:"#","list-type":"picture-card","auto-upload":!1,"on-change":o.handleImageChange,"on-remove":o.handleImageRemove,"before-upload":o.beforeImageUpload,multiple:""},{default:s(()=>[l(v,null,{default:s(()=>[l(N)]),_:1}),t[24]||(t[24]=n("div",{class:"upload-text"},[m("点击上传"),n("br"),m("（最多4张）")],-1))]),file:s(({file:e})=>[n("img",{src:e.url,class:"upload-image"},null,8,Me)]),_:1},8,["file-list","on-change","on-remove","before-upload"])]),_:1}),l(p,{label:"预览"},{default:s(()=>[n("div",Ae,[l(I,null,{default:s(()=>[t[25]||(t[25]=n("div",{class:"preview-header"},"预览效果",-1)),n("div",Ge,[n("h3",null,r(o.postForm.title||"标题待输入..."),1),n("div",Ne,[l(_,{size:"small"},{default:s(()=>[m(r(o.postForm.canteen||"餐厅"),1)]),_:1}),l(_,{size:"small",type:"info"},{default:s(()=>[m(r(o.postForm.window||"窗口"),1)]),_:1}),l(_,{size:"small",type:"warning"},{default:s(()=>[m(r(o.postForm.dish||"菜品"),1)]),_:1})]),n("p",We,r(o.postForm.content||"内容待输入..."),1)])]),_:1})])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])])}const Oe=Y(ce,[["render",Je],["__scopeId","data-v-39bc9c6d"]]);export{Oe as default};
