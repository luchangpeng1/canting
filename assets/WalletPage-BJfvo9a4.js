import{_ as E,ap as I,M as L,i as N,G as T,az as z,ac as W,aA as G,aB as O,ai as H,Y as J,E as g,k as c,n,q as l,w as o,v as d,I as p,a1 as y,x as i,y as r,B as m,z as k,aC as v,J as C,A as f,au as Y,ao as j}from"./index-CjeFGtzt.js";const K={name:"WalletPage",components:{ArrowLeft:I,Plus:L,InfoFilled:N,List:T,SetUp:z,Bell:W,Select:G,Money:O,ChatDotSquare:H},setup(){const a=j();return{userBalance:J(()=>a.getters["user/userBalance"])}},data(){return{lowBalanceThreshold:20,rechargeVisible:!1,autoRechargeVisible:!1,selectedAmount:50,recharging:!1,selectedPaymentMethod:"alipay",quickActions:[{name:"交易记录",icon:"List",handler:()=>this.navigateTo("/transactions")},{name:"自动充值",icon:"SetUp",handler:this.showAutoRechargeSettings},{name:"余额提醒",icon:"Bell",handler:this.showBalanceAlert}],rechargeOptions:[20,50,100,200,300,500],paymentMethods:[{id:"alipay",name:"支付宝支付",icon:"Money",color:"#1677FF"},{id:"wechat",name:"微信支付",icon:"ChatDotSquare",color:"#07C160"}],rechargeNotices:["单次充值金额不低于10元","充值满100元赠送5元","赠送金额将在充值成功后立即到账","充值金额实时到账，可用于校园内消费"],autoRechargeForm:{enabled:!1,threshold:20,amount:50},paymentStatus:{loading:!1,error:null}}},methods:{handleBack(){this.$router.back()},showRechargeDialog(){this.rechargeVisible=!0},closeRechargeDialog(){this.rechargeVisible=!1,this.selectedAmount=50},handleAmountSelect(a){this.selectedAmount=a},calculateBonus(a){return Math.floor(a/100)*5},selectPaymentMethod(a){this.selectedPaymentMethod=a},async handleRecharge(){if(this.selectedAmount<10){g.warning("充值金额不能低于10元");return}this.recharging=!0,this.paymentStatus.error=null;try{const a=await this.processPayment();if(a.success)await this.updateBalance(),g.success("充值成功"),this.closeRechargeDialog();else throw new Error(a.message||"支付失败")}catch(a){this.paymentStatus.error=a.message,g.error(a.message||"充值失败，请重试")}finally{this.recharging=!1}},async processPayment(){const a={amount:this.selectedAmount,paymentMethod:this.selectedPaymentMethod,timestamp:Date.now(),orderId:`RECHARGE_${Date.now()}`};return await new Promise(e=>setTimeout(e,1500)),{success:!0,message:"支付成功",data:a}},async updateBalance(){let a=this.userBalance+this.selectedAmount;if(this.selectedAmount>=100){const e=this.calculateBonus(this.selectedAmount);a+=e}await this.$store.dispatch("user/updateBalance",a),g.success(`充值成功，当前余额 ¥${a.toFixed(2)}`)},showAutoRechargeSettings(){this.autoRechargeVisible=!0},closeAutoRechargeDialog(){this.autoRechargeVisible=!1},saveAutoRechargeSettings(){g.success("设置已保存"),this.closeAutoRechargeDialog()},showBalanceAlert(){g.success("余额提醒已开启")},navigateTo(a){a.startsWith("/student/")||(a="/student"+a),this.$router.push(a)}}},Q={class:"wallet-page"},X={class:"page-header"},Z={class:"balance-card"},$={class:"balance-header"},ee={class:"balance-amount"},te={class:"balance-tips"},se={class:"quick-actions"},le=["onClick"],oe={class:"recharge-section"},ae={class:"recharge-options"},ne=["onClick"],re={class:"amount"},ie={key:0,class:"bonus"},ce={class:"recharge-notice"},ue={class:"recharge-dialog-content"},de={class:"amount-display"},me={class:"amount"},he={key:0,class:"bonus-info"},_e={class:"payment-methods"},ge=["data-method","onClick"],pe={key:0,class:"payment-error"};function fe(a,e,ye,V,s,u){const B=i("ArrowLeft"),h=i("el-icon"),_=i("el-button"),S=i("Plus"),F=i("InfoFilled"),M=i("el-col"),D=i("el-row"),P=i("Money"),x=i("Select"),A=i("el-dialog"),q=i("el-switch"),b=i("el-form-item"),R=i("el-input-number"),U=i("el-form");return r(),c("div",Q,[n("div",X,[l(_,{class:"back-btn",link:"",onClick:u.handleBack},{default:o(()=>[l(h,null,{default:o(()=>[l(B)]),_:1}),e[5]||(e[5]=m(" 返回 "))]),_:1},8,["onClick"]),e[6]||(e[6]=n("h2",{class:"page-title"},"我的钱包",-1))]),n("div",Z,[n("div",$,[e[8]||(e[8]=n("span",{class:"label"},"当前余额",-1)),l(_,{type:"primary",link:"",onClick:u.showRechargeDialog},{default:o(()=>[l(h,null,{default:o(()=>[l(S)]),_:1}),e[7]||(e[7]=m(" 充值 "))]),_:1},8,["onClick"])]),n("div",ee,"¥"+d(V.userBalance.toFixed(2)),1),n("div",te,[l(h,null,{default:o(()=>[l(F)]),_:1}),n("span",null,"余额不足"+d(s.lowBalanceThreshold)+"元时将收到提醒",1)])]),n("div",se,[l(D,{gutter:16},{default:o(()=>[(r(!0),c(p,null,y(s.quickActions,t=>(r(),k(M,{span:8,key:t.name},{default:o(()=>[n("div",{class:"action-item",onClick:t.handler},[l(h,null,{default:o(()=>[(r(),k(v(t.icon)))]),_:2},1024),n("span",null,d(t.name),1)],8,le)]),_:2},1024))),128))]),_:1})]),n("div",oe,[e[9]||(e[9]=n("h3",null,"快捷充值",-1)),n("div",ae,[(r(!0),c(p,null,y(s.rechargeOptions,t=>(r(),c("div",{key:t,class:C(["recharge-option",{active:s.selectedAmount===t}]),onClick:w=>u.handleAmountSelect(t)},[n("span",re,"¥"+d(t),1),t>=100?(r(),c("span",ie,"送"+d(u.calculateBonus(t))+"元",1)):f("",!0)],10,ne))),128))]),l(_,{type:"primary",class:"recharge-button",size:"large",disabled:!s.selectedAmount,onClick:u.showRechargeDialog},{default:o(()=>[m(" 立即充值 ¥"+d(s.selectedAmount),1)]),_:1},8,["disabled","onClick"])]),n("div",ce,[e[10]||(e[10]=n("h3",null,"充值说明",-1)),n("ul",null,[(r(!0),c(p,null,y(s.rechargeNotices,(t,w)=>(r(),c("li",{key:w},d(t),1))),128))])]),l(A,{modelValue:s.rechargeVisible,"onUpdate:modelValue":e[0]||(e[0]=t=>s.rechargeVisible=t),title:"余额充值",width:"90%","show-close":!1},{footer:o(()=>[l(_,{onClick:u.closeRechargeDialog},{default:o(()=>e[12]||(e[12]=[m("取消")])),_:1},8,["onClick"]),l(_,{type:"primary",onClick:u.handleRecharge,loading:s.recharging},{default:o(()=>e[13]||(e[13]=[m(" 确认支付 ")])),_:1},8,["onClick","loading"])]),default:o(()=>[n("div",ue,[n("div",de,[e[11]||(e[11]=n("span",{class:"currency"},"¥",-1)),n("span",me,d(s.selectedAmount.toFixed(2)),1)]),s.selectedAmount>=100?(r(),c("div",he,[l(h,null,{default:o(()=>[l(P)]),_:1}),m(" 赠送"+d(u.calculateBonus(s.selectedAmount))+"元 ",1)])):f("",!0),n("div",_e,[(r(!0),c(p,null,y(s.paymentMethods,t=>(r(),c("div",{key:t.id,class:C(["method-item",{active:s.selectedPaymentMethod===t.id}]),"data-method":t.id,onClick:w=>u.selectPaymentMethod(t.id)},[l(h,{class:"payment-icon",style:Y({color:t.color})},{default:o(()=>[(r(),k(v(t.icon)))]),_:2},1032,["style"]),n("span",null,d(t.name),1),s.selectedPaymentMethod===t.id?(r(),k(h,{key:0},{default:o(()=>[l(x)]),_:1})):f("",!0)],10,ge))),128)),s.paymentStatus.error?(r(),c("div",pe,d(s.paymentStatus.error),1)):f("",!0)])])]),_:1},8,["modelValue"]),l(A,{modelValue:s.autoRechargeVisible,"onUpdate:modelValue":e[4]||(e[4]=t=>s.autoRechargeVisible=t),title:"自动充值设置",width:"90%"},{footer:o(()=>[l(_,{onClick:u.closeAutoRechargeDialog},{default:o(()=>e[17]||(e[17]=[m("取消")])),_:1},8,["onClick"]),l(_,{type:"primary",onClick:u.saveAutoRechargeSettings},{default:o(()=>e[18]||(e[18]=[m("保存")])),_:1},8,["onClick"])]),default:o(()=>[l(U,{model:s.autoRechargeForm,"label-width":"120px"},{default:o(()=>[l(b,{label:"开启自动充值"},{default:o(()=>[l(q,{modelValue:s.autoRechargeForm.enabled,"onUpdate:modelValue":e[1]||(e[1]=t=>s.autoRechargeForm.enabled=t)},null,8,["modelValue"])]),_:1}),s.autoRechargeForm.enabled?(r(),c(p,{key:0},[l(b,{label:"触发余额"},{default:o(()=>[l(R,{modelValue:s.autoRechargeForm.threshold,"onUpdate:modelValue":e[2]||(e[2]=t=>s.autoRechargeForm.threshold=t),min:10,max:100,step:10},{prefix:o(()=>e[14]||(e[14]=[m("低于")])),suffix:o(()=>e[15]||(e[15]=[m("元时")])),_:1},8,["modelValue"])]),_:1}),l(b,{label:"自动充值金额"},{default:o(()=>[l(R,{modelValue:s.autoRechargeForm.amount,"onUpdate:modelValue":e[3]||(e[3]=t=>s.autoRechargeForm.amount=t),min:50,step:50},{suffix:o(()=>e[16]||(e[16]=[m("元")])),_:1},8,["modelValue"])]),_:1})],64)):f("",!0)]),_:1},8,["model"])]),_:1},8,["modelValue"])])}const be=E(K,[["render",fe],["__scopeId","data-v-02a7236d"]]);export{be as default};
