import{_ as Y,C as K,x as i,y as c,k as g,q as l,n,w as s,H as F,X as B,a6 as Q,a8 as Z,a9 as x,aa as ee,L as te,ab as le,ac as oe,g as f,V as O,o as se,B as u,z as U,v as m,A as X,I as j,Y as ne,E as h,ad as ae}from"./index-eMRJYRn7.js";const ie={name:"BackHeader",props:{title:{type:String,required:!0}},setup(){const o=K();return{goBack:()=>{o.back()}}}},re={class:"back-header"};function de(o,t,y,k,P,T){const C=i("el-page-header");return c(),g("div",re,[l(C,{title:y.title,onBack:k.goBack},null,8,["title","onBack"])])}const me=Y(ie,[["render",de],["__scopeId","data-v-5f938278"]]),ue={name:"RecommendationSquare",components:{Edit:Q,CaretTop:Z,ChatDotRound:x,Share:ee,Plus:te,CircleCheckFilled:le,WarningFilled:oe,BackHeader:me},setup(){const o=f([]),t=f(!1),y=f(!1),k=f(""),P=f(""),T=f(""),C=f("latest"),I=f(!1),_=f(0),w=f(null),r=f({type:"recommend",title:"",canteen:"",window:"",dish:"",content:"",images:[],price:0,rating:0}),b={type:[{required:!0,message:"请选择发布类型",trigger:"change"}],title:[{required:!0,message:"请输入标题",trigger:"blur"}],canteen:[{required:!0,message:"请选择餐厅",trigger:"change"}],window:[{required:!0,message:"请选择窗口",trigger:"change"}],dish:[{required:!0,message:"请输入菜品名称",trigger:"blur"}],content:[{required:!0,message:"请输入内容描述",trigger:"blur"}]},$=[{id:1,user:{name:"张三",avatar:""},type:"recommend",title:"中央食堂的红烧肉太好吃了！",canteen:"中央食堂",window:"特色炒菜",dish:"红烧肉",content:"今天中午去吃了红烧肉，肥而不腻，特别推荐！",images:[],createTime:"2024-03-20 12:30",likes:15,isLiked:!1,showComments:!1,comments:[{id:1,user:{name:"李四",avatar:""},content:"同意，我也觉得很好吃",time:"2024-03-20 12:35"}]}],v=f([{id:1,name:"中央食堂",windows:[{id:1,name:"特色炒菜"},{id:2,name:"面食档口"}]},{id:2,name:"沁园餐厅",windows:[{id:3,name:"盖浇饭窗口"},{id:4,name:"小炒窗口"}]}]),R=O(()=>{if(!r.value.canteen)return[];const a=v.value.find(e=>e.name===r.value.canteen);return a?a.windows:[]}),q=O(()=>{let a=[...o.value];switch(P.value&&(a=a.filter(e=>e.type===P.value)),T.value&&(a=a.filter(e=>e.canteen===T.value)),C.value){case"mostLiked":a.sort((e,d)=>d.likes-e.likes);break;case"mostComments":a.sort((e,d)=>d.comments.length-e.comments.length);break;default:a.sort((e,d)=>new Date(d.createTime)-new Date(e.createTime))}return a}),z=()=>{t.value=!0},S=a=>{r.value.images.push(a)},E=async()=>{y.value=!0;try{await new Promise(a=>setTimeout(a,1e3)),h.success("发布成功"),t.value=!1,r.value={type:"recommend",title:"",canteen:"",window:"",dish:"",content:"",images:[],price:0,rating:0}}catch{h.error("发布失败")}finally{y.value=!1}},V=a=>{a.isLiked=!a.isLiked,a.likes+=a.isLiked?1:-1},L=a=>{a.showComments=!a.showComments},A=async a=>{if(!k.value.trim()){h.warning("请输入评论内容");return}try{const e={id:Date.now(),user:{name:"当前用户",avatar:""},content:k.value,time:new Date().toLocaleString()};a.comments.push(e),k.value="",h.success("评论成功")}catch{h.error("评论失败")}},M=(a,e)=>{_.value=a,I.value=!0},p=a=>a===1?"single-image":a===2?"two-images":a===3?"three-images":"four-images",N=a=>{r.value.window=""},G=a=>{const e=a.type==="image/jpeg",d=a.type==="image/png",J=a.size/1024/1024<2;return!e&&!d?(h.error("只能上传 JPG 或 PNG 格式的图片!"),!1):J?r.value.images.length>=4?(h.warning("最多只能上传4张图片"),!1):!0:(h.error("图片大小不能超过 2MB!"),!1)},W=a=>{const e=r.value.images.indexOf(a);e!==-1&&r.value.images.splice(e,1)},H=()=>{ae.confirm("确定要取消发布吗？已输入的内容将会丢失","提示",{confirmButtonText:"确定",cancelButtonText:"继续编辑",type:"warning"}).then(()=>{t.value=!1,D()}).catch(()=>{})},D=()=>{w.value&&w.value.resetFields(),r.value={type:"recommend",title:"",canteen:"",window:"",dish:"",content:"",images:[],price:0,rating:0}};return se(()=>{o.value=$}),{posts:o,postDialogVisible:t,posting:y,postForm:r,commentText:k,canteens:v,filteredWindows:R,filterType:P,filterCanteen:T,sortBy:C,showPostDialog:z,handleImageChange:S,submitPost:E,toggleLike:V,showComments:L,submitComment:A,previewImage:M,getImageGridClass:p,filteredPosts:q,handleCanteenChange:N,beforeImageUpload:G,handleImageRemove:W,cancelPost:H,resetForm:D,postFormRef:w,postRules:b}}},ce=ue,pe={class:"recommendation-square"},fe={class:"post-action"},ge={class:"filter-bar"},ve={class:"posts-list"},_e={class:"post-header"},we={class:"user-info"},he={class:"user-detail"},ke={class:"username"},be={class:"post-time"},ye={class:"post-content"},Ce={class:"post-title"},Ve={class:"location-info"},Fe={class:"post-text"},Be={key:0,class:"post-images"},Pe={class:"post-actions"},Te=["onClick"],Ue=["onClick"],$e={class:"action-item"},Le={key:0,class:"comments-section"},De={class:"comments-list"},Ie={class:"comment-content"},Re={class:"comment-user"},qe={class:"comment-text"},ze={class:"comment-time"},Se={class:"comment-input"},Ee={class:"post-type-selector"},Ae=["src"],Me={class:"post-preview"},Ne={class:"preview-content"},Ge={class:"preview-tags"},We={class:"preview-text"},He={class:"dialog-footer"};function Je(o,t,y,k,P,T){const C=i("back-header"),I=i("Edit"),_=i("el-icon"),w=i("el-button"),r=i("el-option"),b=i("el-select"),$=i("el-avatar"),v=i("el-tag"),R=i("el-image"),q=i("CaretTop"),z=i("ChatDotRound"),S=i("Share"),E=i("el-divider"),V=i("el-input"),L=i("el-card"),A=i("CircleCheckFilled"),M=i("WarningFilled"),p=i("el-form-item"),N=i("el-input-number"),G=i("el-rate"),W=i("Plus"),H=i("el-upload"),D=i("el-form"),a=i("el-dialog");return c(),g("div",pe,[l(C,{title:"餐品推荐广场"}),n("div",fe,[l(w,{type:"primary",onClick:o.showPostDialog},{default:s(()=>[l(_,null,{default:s(()=>[l(I)]),_:1}),t[16]||(t[16]=u(" 发布推荐/避雷 "))]),_:1},8,["onClick"])]),n("div",ge,[l(b,{modelValue:o.filterType,"onUpdate:modelValue":t[0]||(t[0]=e=>o.filterType=e),placeholder:"帖子类型",class:"filter-item"},{default:s(()=>[l(r,{label:"全部",value:""}),l(r,{label:"推荐",value:"recommend"}),l(r,{label:"避雷",value:"warning"})]),_:1},8,["modelValue"]),l(b,{modelValue:o.filterCanteen,"onUpdate:modelValue":t[1]||(t[1]=e=>o.filterCanteen=e),placeholder:"选择餐厅",class:"filter-item"},{default:s(()=>[l(r,{label:"全部餐厅",value:""}),(c(!0),g(F,null,B(o.canteens,e=>(c(),U(r,{key:e.id,label:e.name,value:e.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),l(b,{modelValue:o.sortBy,"onUpdate:modelValue":t[2]||(t[2]=e=>o.sortBy=e),placeholder:"排序方式",class:"filter-item"},{default:s(()=>[l(r,{label:"最新发布",value:"latest"}),l(r,{label:"最多点赞",value:"mostLiked"}),l(r,{label:"最多评论",value:"mostComments"})]),_:1},8,["modelValue"])]),n("div",ve,[(c(!0),g(F,null,B(o.filteredPosts,e=>(c(),U(L,{key:e.id,class:"post-card"},{default:s(()=>[n("div",_e,[n("div",we,[l($,{size:40,src:e.user.avatar},{default:s(()=>[u(m(e.user.name.charAt(0)),1)]),_:2},1032,["src"]),n("div",he,[n("span",ke,m(e.user.name),1),n("span",be,m(e.createTime),1)])]),l(v,{type:e.type==="recommend"?"success":"danger"},{default:s(()=>[u(m(e.type==="recommend"?"推荐":"避雷"),1)]),_:2},1032,["type"])]),n("div",ye,[n("h3",Ce,m(e.title),1),n("div",Ve,[l(v,{size:"small"},{default:s(()=>[u(m(e.canteen),1)]),_:2},1024),l(v,{size:"small",type:"info"},{default:s(()=>[u(m(e.window),1)]),_:2},1024),l(v,{size:"small",type:"warning"},{default:s(()=>[u(m(e.dish),1)]),_:2},1024)]),n("p",Fe,m(e.content),1),e.images.length?(c(),g("div",Be,[(c(!0),g(F,null,B(e.images,(d,J)=>(c(),U(R,{key:J,src:d,"preview-src-list":e.images,class:"post-image"},null,8,["src","preview-src-list"]))),128))])):X("",!0)]),n("div",Pe,[n("div",{class:"action-item",onClick:d=>o.toggleLike(e)},[l(_,{class:j({active:e.isLiked})},{default:s(()=>[l(q)]),_:2},1032,["class"]),n("span",null,m(e.likes)+"赞",1)],8,Te),n("div",{class:"action-item",onClick:d=>o.showComments(e)},[l(_,null,{default:s(()=>[l(z)]),_:1}),n("span",null,m(e.comments.length)+"评论",1)],8,Ue),n("div",$e,[l(_,null,{default:s(()=>[l(S)]),_:1}),t[17]||(t[17]=n("span",null,"分享",-1))])]),e.showComments?(c(),g("div",Le,[l(E,null,{default:s(()=>t[18]||(t[18]=[u("评论区")])),_:1}),n("div",De,[(c(!0),g(F,null,B(e.comments,d=>(c(),g("div",{key:d.id,class:"comment-item"},[l($,{size:32,src:d.user.avatar},{default:s(()=>[u(m(d.user.name.charAt(0)),1)]),_:2},1032,["src"]),n("div",Ie,[n("div",Re,m(d.user.name),1),n("div",qe,m(d.content),1),n("div",ze,m(d.time),1)])]))),128))]),n("div",Se,[l(V,{modelValue:o.commentText,"onUpdate:modelValue":t[3]||(t[3]=d=>o.commentText=d),placeholder:"写下你的评论...",rows:2,type:"textarea"},null,8,["modelValue"]),l(w,{type:"primary",onClick:d=>o.submitComment(e)},{default:s(()=>t[19]||(t[19]=[u("发表评论")])),_:2},1032,["onClick"])])])):X("",!0)]),_:2},1024))),128))]),l(a,{title:"发布推荐/避雷",modelValue:o.postDialogVisible,"onUpdate:modelValue":t[15]||(t[15]=e=>o.postDialogVisible=e),width:"90%","close-on-click-modal":!1,class:"post-dialog"},{footer:s(()=>[n("div",He,[l(w,{onClick:o.cancelPost},{default:s(()=>t[26]||(t[26]=[u("取消")])),_:1},8,["onClick"]),l(w,{type:"primary",onClick:o.submitPost,loading:o.posting},{default:s(()=>t[27]||(t[27]=[u(" 发布 ")])),_:1},8,["onClick","loading"])])]),default:s(()=>[l(D,{model:o.postForm,rules:o.postRules,ref:"postFormRef","label-width":"80px",onSubmit:t[14]||(t[14]=ne(()=>{},["prevent"]))},{default:s(()=>[l(p,{label:"类型",prop:"type"},{default:s(()=>[n("div",Ee,[n("div",{class:j(["type-item",{active:o.postForm.type==="recommend"}]),onClick:t[4]||(t[4]=e=>o.postForm.type="recommend")},[l(_,null,{default:s(()=>[l(A)]),_:1}),t[20]||(t[20]=n("span",null,"推荐好物",-1)),t[21]||(t[21]=n("small",null,"分享美食发现",-1))],2),n("div",{class:j(["type-item",{active:o.postForm.type==="warning"}]),onClick:t[5]||(t[5]=e=>o.postForm.type="warning")},[l(_,null,{default:s(()=>[l(M)]),_:1}),t[22]||(t[22]=n("span",null,"避雷提醒",-1)),t[23]||(t[23]=n("small",null,"帮助他人避坑",-1))],2)])]),_:1}),l(p,{label:"标题",prop:"title"},{default:s(()=>[l(V,{modelValue:o.postForm.title,"onUpdate:modelValue":t[6]||(t[6]=e=>o.postForm.title=e),placeholder:"一句话描述你的体验（最多30字）",maxlength:"30","show-word-limit":""},null,8,["modelValue"])]),_:1}),l(p,{label:"餐厅",prop:"canteen"},{default:s(()=>[l(b,{modelValue:o.postForm.canteen,"onUpdate:modelValue":t[7]||(t[7]=e=>o.postForm.canteen=e),placeholder:"选择餐厅",filterable:"",onChange:o.handleCanteenChange},{default:s(()=>[(c(!0),g(F,null,B(o.canteens,e=>(c(),U(r,{key:e.id,label:e.name,value:e.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue","onChange"])]),_:1}),l(p,{label:"窗口",prop:"window"},{default:s(()=>[l(b,{modelValue:o.postForm.window,"onUpdate:modelValue":t[8]||(t[8]=e=>o.postForm.window=e),placeholder:"选择窗口",filterable:"",disabled:!o.postForm.canteen},{default:s(()=>[(c(!0),g(F,null,B(o.filteredWindows,e=>(c(),U(r,{key:e.id,label:e.name,value:e.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1}),l(p,{label:"菜品",prop:"dish"},{default:s(()=>[l(V,{modelValue:o.postForm.dish,"onUpdate:modelValue":t[9]||(t[9]=e=>o.postForm.dish=e),placeholder:"输入菜品名称",maxlength:"20","show-word-limit":""},null,8,["modelValue"])]),_:1}),l(p,{label:"价格"},{default:s(()=>[l(N,{modelValue:o.postForm.price,"onUpdate:modelValue":t[10]||(t[10]=e=>o.postForm.price=e),min:0,precision:2,step:.5},null,8,["modelValue"])]),_:1}),l(p,{label:"评分"},{default:s(()=>[l(G,{modelValue:o.postForm.rating,"onUpdate:modelValue":t[11]||(t[11]=e=>o.postForm.rating=e),colors:["#99A9BF","#F7BA2A","#FF9900"]},null,8,["modelValue"])]),_:1}),l(p,{label:"内容",prop:"content"},{default:s(()=>[l(V,{modelValue:o.postForm.content,"onUpdate:modelValue":t[12]||(t[12]=e=>o.postForm.content=e),type:"textarea",rows:4,placeholder:"详细描述你的体验...",maxlength:"500","show-word-limit":""},null,8,["modelValue"])]),_:1}),l(p,{label:"图片"},{default:s(()=>[l(H,{"file-list":o.postForm.images,"onUpdate:fileList":t[13]||(t[13]=e=>o.postForm.images=e),action:"#","list-type":"picture-card","auto-upload":!1,"on-change":o.handleImageChange,"on-remove":o.handleImageRemove,"before-upload":o.beforeImageUpload,multiple:""},{default:s(()=>[l(_,null,{default:s(()=>[l(W)]),_:1}),t[24]||(t[24]=n("div",{class:"upload-text"},[u("点击上传"),n("br"),u("（最多4张）")],-1))]),file:s(({file:e})=>[n("img",{src:e.url,class:"upload-image"},null,8,Ae)]),_:1},8,["file-list","on-change","on-remove","before-upload"])]),_:1}),l(p,{label:"预览"},{default:s(()=>[n("div",Me,[l(L,null,{default:s(()=>[t[25]||(t[25]=n("div",{class:"preview-header"},"预览效果",-1)),n("div",Ne,[n("h3",null,m(o.postForm.title||"标题待输入..."),1),n("div",Ge,[l(v,{size:"small"},{default:s(()=>[u(m(o.postForm.canteen||"餐厅"),1)]),_:1}),l(v,{size:"small",type:"info"},{default:s(()=>[u(m(o.postForm.window||"窗口"),1)]),_:1}),l(v,{size:"small",type:"warning"},{default:s(()=>[u(m(o.postForm.dish||"菜品"),1)]),_:1})]),n("p",We,m(o.postForm.content||"内容待输入..."),1)])]),_:1})])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])])}const Oe=Y(ce,[["render",Je],["__scopeId","data-v-c9a69249"]]);export{Oe as default};
