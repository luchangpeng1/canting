import{B}from"./BackHeader-DICDbJP6.js";import{av as V,aw as j,_ as z,ax as p,g as C,Y as F,ay as N,o as A,j as O,k as m,q as v,n as a,z as k,I as x,a1 as M,ao as R,x as g,y as l,v as d,w,B as L,A as H}from"./index-CjeFGtzt.js";var E={exports:{}};(function(h,n){(function(c,s){h.exports=s(V)})(j,function(c){function s(o){return o&&typeof o=="object"&&"default"in o?o:{default:o}}var Y=s(c),f={name:"zh-cn",weekdays:"星期日_星期一_星期二_星期三_星期四_星期五_星期六".split("_"),weekdaysShort:"周日_周一_周二_周三_周四_周五_周六".split("_"),weekdaysMin:"日_一_二_三_四_五_六".split("_"),months:"一月_二月_三月_四月_五月_六月_七月_八月_九月_十月_十一月_十二月".split("_"),monthsShort:"1月_2月_3月_4月_5月_6月_7月_8月_9月_10月_11月_12月".split("_"),ordinal:function(o,u){return u==="W"?o+"周":o+"日"},weekStart:1,yearStart:4,formats:{LT:"HH:mm",LTS:"HH:mm:ss",L:"YYYY/MM/DD",LL:"YYYY年M月D日",LLL:"YYYY年M月D日Ah点mm分",LLLL:"YYYY年M月D日ddddAh点mm分",l:"YYYY/M/D",ll:"YYYY年M月D日",lll:"YYYY年M月D日 HH:mm",llll:"YYYY年M月D日dddd HH:mm"},relativeTime:{future:"%s内",past:"%s前",s:"几秒",m:"1 分钟",mm:"%d 分钟",h:"1 小时",hh:"%d 小时",d:"1 天",dd:"%d 天",M:"1 个月",MM:"%d 个月",y:"1 年",yy:"%d 年"},meridiem:function(o,u){var _=100*o+u;return _<600?"凌晨":_<900?"早上":_<1100?"上午":_<1300?"中午":_<1800?"下午":"晚上"}};return Y.default.locale(f,null,!0),f})})(E);p.locale("zh-cn");const I={name:"FeedbackList",components:{BackHeader:B},setup(){const h=R(),n=C([]),c=C(null),s=[{id:1,type:"dish",content:"建议增加水果种类",time:"2024-03-19 14:30",status:"replied",images:[],reply:"感谢您的建议,我们会考虑增加更多品种的水果",replyTime:"2024-03-19 15:00",canteen:"第一食堂",stall:"水果档口"},{id:2,type:"service",content:"希望能延长营业时间",time:"2024-03-18 20:00",status:"pending",images:[],reply:null,replyTime:null,canteen:"第二食堂",stall:"快餐窗口"}],Y=F(()=>n.value.length);N(Y,e=>{h.dispatch("user/updateFeedbacksCount",e)},{immediate:!0}),A(async()=>{n.value=s,h.dispatch("user/updateFeedbacksCount",s.length)}),O(()=>{});const f=[{text:"最近一周",value:()=>{const e=new Date,t=new Date;return t.setTime(t.getTime()-3600*1e3*24*7),[t,e]}},{text:"最近一个月",value:()=>{const e=new Date,t=new Date;return t.setTime(t.getTime()-3600*1e3*24*30),[t,e]}},{text:"最近三个月",value:()=>{const e=new Date,t=new Date;return t.setTime(t.getTime()-3600*1e3*24*90),[t,e]}}],o=F(()=>{const t=(c.value?n.value.filter(r=>{const i=p(r.time).format("YYYY-MM-DD");return i>=c.value[0]&&i<=c.value[1]}):n.value).reduce((r,i)=>{const T=p(i.time).format("YYYY-MM-DD");return r[T]||(r[T]=[]),r[T].push(i),r},{});return Object.entries(t).map(([r,i])=>({date:r,items:i})).sort((r,i)=>p(i.date).valueOf()-p(r.date).valueOf())});return{feedbacks:n,dateRange:c,dateShortcuts:f,groupedFeedbacks:o,formatDateLabel:e=>{const t=p().format("YYYY-MM-DD"),r=p().subtract(1,"day").format("YYYY-MM-DD");return e===t?"今天":e===r?"昨天":p(e).format("M月D日")},handleDateChange:e=>{c.value=e},getTypeTag:e=>({dish:"success",service:"warning",environment:"info",other:""})[e]||"",getTypeText:e=>({dish:"菜品建议",service:"服务建议",environment:"环境建议",other:"其他建议"})[e]||e,getStatusType:e=>({pending:"info",processing:"warning",replied:"success",closed:""})[e]||"",getStatusText:e=>({pending:"待处理",processing:"处理中",replied:"已回复",closed:"已关闭"})[e]||e,totalFeedbacks:Y}}},U={class:"feedback-list"},q={class:"filter-section"},G={key:1,class:"feedback-items"},W={class:"date-divider"},J={class:"date-text"},K={class:"feedback-header"},P={class:"feedback-type"},Q={class:"location-info"},X={class:"location-item"},Z={class:"location-item"},$={class:"time"},ee={class:"feedback-content"},te={class:"content-text"},se={key:0,class:"feedback-images"},ae={key:0,class:"feedback-reply"},ne={class:"reply-content"},oe={class:"reply-time"};function re(h,n,c,s,Y,f){const o=g("back-header"),u=g("el-date-picker"),_=g("el-empty"),D=g("el-tag"),b=g("el-image"),S=g("el-card");return l(),m("div",U,[v(o,{title:"我的建议"}),a("div",q,[v(u,{modelValue:s.dateRange,"onUpdate:modelValue":n[0]||(n[0]=y=>s.dateRange=y),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",shortcuts:s.dateShortcuts,onChange:s.handleDateChange,"value-format":"YYYY-MM-DD",class:"date-picker"},null,8,["modelValue","shortcuts","onChange"])]),s.groupedFeedbacks.length===0?(l(),k(_,{key:0,description:"暂无反馈记录"})):(l(),m("div",G,[(l(!0),m(x,null,M(s.groupedFeedbacks,y=>(l(),m("div",{key:y.date,class:"feedback-group"},[a("div",W,[a("span",J,d(s.formatDateLabel(y.date)),1)]),(l(!0),m(x,null,M(y.items,e=>(l(),k(S,{key:e.id,class:"feedback-card",shadow:"hover"},{default:w(()=>[a("div",K,[a("div",P,[v(D,{type:s.getTypeTag(e.type),class:"type-tag",effect:"dark"},{default:w(()=>[L(d(s.getTypeText(e.type)),1)]),_:2},1032,["type"])]),v(D,{type:s.getStatusType(e.status),size:"small",class:"status-tag",effect:"plain"},{default:w(()=>[L(d(s.getStatusText(e.status)),1)]),_:2},1032,["type"])]),a("div",Q,[a("span",X,[n[1]||(n[1]=a("i",{class:"el-icon-location"},null,-1)),L(" "+d(e.canteen),1)]),n[2]||(n[2]=a("span",{class:"location-divider"},"·",-1)),a("span",Z,d(e.stall),1),a("span",$,d(e.time),1)]),a("div",ee,[a("p",te,d(e.content),1),e.images.length?(l(),m("div",se,[(l(!0),m(x,null,M(e.images,(t,r)=>(l(),k(b,{key:r,src:t,"preview-src-list":e.images,fit:"cover",class:"feedback-image"},null,8,["src","preview-src-list"]))),128))])):H("",!0)]),e.reply?(l(),m("div",ae,[n[3]||(n[3]=a("div",{class:"reply-header"},[a("i",{class:"el-icon-chat-dot-round"}),a("span",{class:"reply-title"},"官方回复")],-1)),a("p",ne,d(e.reply),1),a("p",oe,d(e.replyTime),1)])):H("",!0)]),_:2},1024))),128))]))),128))]))])}const ie=z(I,[["render",re],["__scopeId","data-v-71bec855"]]);export{ie as default};
