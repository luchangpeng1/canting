import{_ as K,aP as Q,V as W,aa as G,aS as X,Q as Z,l as $,b as ee,b4 as te,U as ae,r as ne,g as v,Y as H,ay as le,o as oe,k as C,q as a,w as n,n as s,$ as ie,z as D,ax as S,E as J,x as d,aK as re,y as p,I as V,a1 as F,J as de,v as u,aC as se,B as c,A as ce}from"./index-CjeFGtzt.js";const ue={1:[{id:101,name:"川湘菜窗口"},{id:102,name:"粤式炖汤"},{id:103,name:"新疆风味"},{id:104,name:"面食档口"}],2:[{id:201,name:"江浙小炒"},{id:202,name:"东北菜"},{id:203,name:"清真窗口"}],3:[{id:301,name:"特色炒饭"},{id:302,name:"火锅窗口"},{id:303,name:"小吃档口"}],4:[{id:401,name:"日韩料理"},{id:402,name:"西式快餐"},{id:403,name:"粉面档口"}],5:[{id:501,name:"创意简餐"},{id:502,name:"养生套餐"},{id:503,name:"水饺馄饨"}]},_e=[{id:1,order_id:"ORD20240301001",canteen_id:1,canteen:"中央食堂",window_id:101,window:"川湘菜窗口",dishes:[{id:1,name:"宫保鸡丁",price:18,quantity:1},{id:2,name:"米饭",price:2,quantity:2}],total_amount:22,meal_type:"dine_in",status:"pending",created_at:"2024-03-01 12:30:00",remark:"不要太辣"},{id:2,order_id:"ORD20240301002",canteen_id:2,canteen:"沁园餐厅",window_id:201,window:"江浙小炒",dishes:[{id:3,name:"糖醋里脊",price:22,quantity:1},{id:4,name:"蛋炒饭",price:12,quantity:1}],total_amount:34,meal_type:"takeout",status:"accepted",created_at:"2024-03-01 12:35:00",remark:""},{id:3,order_id:"ORD20240301003",canteen_id:3,canteen:"馨园餐厅",window_id:302,window:"火锅窗口",dishes:[{id:5,name:"牛肉火锅",price:48,quantity:1},{id:6,name:"青菜拼盘",price:15,quantity:1}],total_amount:63,meal_type:"dine_in",status:"completed",created_at:"2024-03-01 13:00:00",remark:"多放香菜"},{id:4,order_id:"ORD20240301004",canteen_id:4,canteen:"仲园餐厅",window_id:401,window:"日韩料理",dishes:[{id:7,name:"寿司拼盘",price:35,quantity:1},{id:8,name:"味增汤",price:8,quantity:1}],total_amount:43,meal_type:"dine_in",status:"pending",created_at:"2024-03-01 13:15:00",remark:""},{id:5,order_id:"ORD20240301005",canteen_id:5,canteen:"雅园餐厅",window_id:502,window:"养生套餐",dishes:[{id:9,name:"五谷杂粮套餐",price:28,quantity:1},{id:10,name:"银耳汤",price:12,quantity:1}],total_amount:40,meal_type:"takeout",status:"accepted",created_at:"2024-03-01 13:30:00",remark:"汤要热的"}],me={name:"OrderManagement",components:{Download:Q,ShoppingCart:W,Check:G,Close:X,Timer:Z,Location:$,Shop:ee,Files:te,Search:ae,Refresh:ne},setup(){const z=v(!1),l=v([]),M=v(1),t=v(20),Y=v(0),g=v(""),m=v(""),w=v([]),T=v(!1),q=v(null),y=v(""),h=v([{title:"今日订单",value:0,type:"primary",icon:"ShoppingCart"},{title:"待处理",value:0,type:"warning",icon:"Timer"},{title:"已完成",value:0,type:"success",icon:"Check"},{title:"已取消",value:0,type:"danger",icon:"Close"}]),O=[{id:1,name:"中央食堂"},{id:2,name:"沁园餐厅"},{id:3,name:"馨园餐厅"},{id:4,name:"仲园餐厅"},{id:5,name:"雅园餐厅"}],U=[{value:"pending",label:"待处理"},{value:"accepted",label:"已接单"},{value:"completed",label:"已完成"},{value:"cancelled",label:"已取消"}],B=[{text:"最近一周",value:()=>{const i=new Date,o=new Date;return o.setTime(o.getTime()-3600*1e3*24*7),[o,i]}},{text:"最近一个月",value:()=>{const i=new Date,o=new Date;return o.setTime(o.getTime()-3600*1e3*24*30),[o,i]}}],P=H(()=>g.value?ue[g.value]||[]:[]),j=(i,o)=>{if(!o||o.length!==2)return!0;const[e,r]=o,k=S(i);return k.isAfter(S(e).startOf("day"))&&k.isBefore(S(r).endOf("day"))},b=H(()=>l.value.filter(i=>{const o=!m.value||i.status===m.value,e=!w.value||j(i.created_at,w.value),r=!g.value||i.canteen_id===g.value,k=!y.value||i.window_id===y.value;return o&&e&&r&&k}));H(()=>({totalRevenue:l.value.reduce((i,o)=>i+o.total_amount,0),totalOrders:l.value.length,canteenStats:O.map(i=>({name:i.name,revenue:l.value.filter(o=>o.canteen_id===i.id).reduce((o,e)=>o+e.total_amount,0),orderCount:l.value.filter(o=>o.canteen_id===i.id).length}))})),le(g,()=>{y.value=""});const L=i=>({pending:"warning",accepted:"primary",completed:"success",cancelled:"info",rejected:"danger"})[i]||"info",N=i=>({pending:"待处理",accepted:"已接单",completed:"已完成",cancelled:"已取消",rejected:"已拒绝"})[i]||i,_=i=>S(i).format("YYYY-MM-DD HH:mm:ss"),x=()=>{J.success("订单导出功能在前端模式下不可用")},E=i=>{q.value=i,T.value=!0},R=i=>{t.value=i,f()},I=i=>{M.value=i,f()},f=async()=>{var i;z.value=!0;try{await new Promise(r=>setTimeout(r,500));let o=[..._e];g.value&&(o=o.filter(r=>r.canteen_id===g.value)),m.value&&(o=o.filter(r=>r.status===m.value)),((i=w.value)==null?void 0:i.length)===2&&(o=o.filter(r=>{const k=new Date(r.created_at);return k>=w.value[0]&&k<=w.value[1]})),l.value=o,Y.value=o.length;const e=S().format("YYYY-MM-DD");h.value[0].value=o.filter(r=>r.created_at.startsWith(e)).length,h.value[1].value=o.filter(r=>r.status==="pending").length,h.value[2].value=o.filter(r=>r.status==="completed").length,h.value[3].value=o.filter(r=>r.status==="cancelled").length}catch{J.error("获取订单列表失败")}finally{z.value=!1}},A=()=>{g.value="",y.value="",m.value="",w.value=[],f()};return oe(()=>{f()}),{loading:z,orders:l,currentPage:M,pageSize:t,total:Y,canteenFilter:g,statusFilter:m,dateRange:w,detailDialogVisible:T,currentOrder:q,statistics:h,canteens:O,orderStatuses:U,dateShortcuts:B,filteredOrders:b,getStatusType:L,getStatusText:N,formatDateTime:_,exportOrders:x,showOrderDetail:E,handleSizeChange:R,handleCurrentChange:I,windowFilter:y,windows:P,resetFilters:A,fetchOrders:f}}},pe={class:"order-management"},fe={class:"stat-content"},ve={class:"stat-value"},ge={class:"stat-title"},we={class:"toolbar-container"},he={class:"toolbar"},ye={class:"filter-group"},be={class:"location-filters"},ke={class:"status-filters"},Ce={class:"action-group"},De={class:"order-dishes"},Oe={class:"pagination"},xe={key:0,class:"order-detail"},Se={class:"detail-section"},Ve={class:"detail-section"},Fe={class:"order-total"},ze={class:"total-amount"},Te={class:"detail-section"},qe={class:"remark"};function Re(z,l,M,t,Y,g){const m=d("el-icon"),w=d("el-card"),T=d("el-col"),q=d("el-row"),y=d("Location"),h=d("el-option"),O=d("el-select"),U=d("Shop"),B=d("Files"),P=d("el-date-picker"),j=d("Search"),b=d("el-button"),L=d("Refresh"),N=d("Download"),_=d("el-table-column"),x=d("el-tag"),E=d("el-tooltip"),R=d("el-table"),I=d("el-pagination"),f=d("el-descriptions-item"),A=d("el-descriptions"),i=d("el-dialog"),o=re("loading");return p(),C("div",pe,[a(q,{gutter:20,class:"statistics"},{default:n(()=>[(p(!0),C(V,null,F(t.statistics,e=>(p(),D(T,{span:6,key:e.title},{default:n(()=>[a(w,{class:de(["stat-card",e.type])},{default:n(()=>[s("div",fe,[s("div",ve,u(e.value),1),s("div",ge,u(e.title),1)]),a(m,{class:"stat-icon"},{default:n(()=>[(p(),D(se(e.icon)))]),_:2},1024)]),_:2},1032,["class"])]),_:2},1024))),128))]),_:1}),s("div",we,[s("div",he,[s("div",ye,[s("div",be,[a(O,{modelValue:t.canteenFilter,"onUpdate:modelValue":l[0]||(l[0]=e=>t.canteenFilter=e),placeholder:"选择餐厅",clearable:"",class:"filter-item",onChange:l[1]||(l[1]=e=>t.windowFilter="")},{prefix:n(()=>[a(m,null,{default:n(()=>[a(y)]),_:1})]),default:n(()=>[(p(!0),C(V,null,F(t.canteens,e=>(p(),D(h,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),a(O,{modelValue:t.windowFilter,"onUpdate:modelValue":l[2]||(l[2]=e=>t.windowFilter=e),placeholder:"选择窗口",clearable:"",class:"filter-item",disabled:!t.canteenFilter},{prefix:n(()=>[a(m,null,{default:n(()=>[a(U)]),_:1})]),default:n(()=>[(p(!0),C(V,null,F(t.windows,e=>(p(),D(h,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),s("div",ke,[a(O,{modelValue:t.statusFilter,"onUpdate:modelValue":l[3]||(l[3]=e=>t.statusFilter=e),placeholder:"订单状态",class:"filter-item",clearable:""},{prefix:n(()=>[a(m,null,{default:n(()=>[a(B)]),_:1})]),default:n(()=>[(p(!0),C(V,null,F(t.orderStatuses,e=>(p(),D(h,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),a(P,{modelValue:t.dateRange,"onUpdate:modelValue":l[4]||(l[4]=e=>t.dateRange=e),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",class:"filter-item date-picker",shortcuts:t.dateShortcuts},null,8,["modelValue","shortcuts"])])]),s("div",Ce,[a(b,{type:"primary",onClick:t.fetchOrders},{default:n(()=>[a(m,null,{default:n(()=>[a(j)]),_:1}),l[9]||(l[9]=c("查询 "))]),_:1},8,["onClick"]),a(b,{onClick:t.resetFilters},{default:n(()=>[a(m,null,{default:n(()=>[a(L)]),_:1}),l[10]||(l[10]=c("重置 "))]),_:1},8,["onClick"]),a(b,{type:"success",onClick:t.exportOrders},{default:n(()=>[a(m,null,{default:n(()=>[a(N)]),_:1}),l[11]||(l[11]=c("导出订单 "))]),_:1},8,["onClick"])])])]),ie((p(),D(R,{data:t.filteredOrders,style:{width:"100%"},border:"",stripe:""},{default:n(()=>[a(_,{prop:"order_id",label:"订单号",width:"160",fixed:""}),a(_,{prop:"canteen",label:"餐厅",width:"120"}),a(_,{prop:"window",label:"窗口",width:"120"}),a(_,{label:"订单内容","min-width":"200"},{default:n(({row:e})=>[s("div",De,[(p(!0),C(V,null,F(e.dishes,r=>(p(),D(E,{key:r.id,content:`${r.name} x${r.quantity}`,placement:"top","show-after":500},{default:n(()=>[a(x,{size:"small",class:"dish-tag",style:{cursor:"pointer"}},{default:n(()=>[c(u(r.name)+" x"+u(r.quantity),1)]),_:2},1024)]),_:2},1032,["content"]))),128))])]),_:1}),a(_,{prop:"total_amount",label:"金额",width:"100",align:"right"},{default:n(({row:e})=>[c(" ¥"+u(e.total_amount.toFixed(2)),1)]),_:1}),a(_,{prop:"meal_type",label:"就餐方式",width:"90",align:"center"},{default:n(({row:e})=>[a(x,{type:e.meal_type==="dine_in"?"success":"warning",size:"small"},{default:n(()=>[c(u(e.meal_type==="dine_in"?"堂食":"打包"),1)]),_:2},1032,["type"])]),_:1}),a(_,{prop:"status",label:"状态",width:"90",align:"center"},{default:n(({row:e})=>[a(x,{type:t.getStatusType(e.status),size:"small"},{default:n(()=>[c(u(t.getStatusText(e.status)),1)]),_:2},1032,["type"])]),_:1}),a(_,{prop:"created_at",label:"下单时间",width:"150",align:"center"},{default:n(({row:e})=>[c(u(t.formatDateTime(e.created_at)),1)]),_:1}),a(_,{label:"操作",width:"150",fixed:"right",align:"center"},{default:n(({row:e})=>[a(b,{link:"",type:"primary",onClick:r=>t.showOrderDetail(e)},{default:n(()=>l[12]||(l[12]=[c(" 查看 ")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[o,t.loading]]),s("div",Oe,[a(I,{"current-page":t.currentPage,"onUpdate:currentPage":l[5]||(l[5]=e=>t.currentPage=e),"page-size":t.pageSize,"onUpdate:pageSize":l[6]||(l[6]=e=>t.pageSize=e),"page-sizes":[10,20,50,100],total:t.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:t.handleSizeChange,onCurrentChange:t.handleCurrentChange},null,8,["current-page","page-size","total","onSizeChange","onCurrentChange"])]),a(i,{title:"订单详情",modelValue:t.detailDialogVisible,"onUpdate:modelValue":l[8]||(l[8]=e=>t.detailDialogVisible=e),width:"600px"},{footer:n(()=>[a(b,{onClick:l[7]||(l[7]=e=>t.detailDialogVisible=!1)},{default:n(()=>l[17]||(l[17]=[c("关闭")])),_:1})]),default:n(()=>[t.currentOrder?(p(),C("div",xe,[s("div",Se,[l[13]||(l[13]=s("h4",null,"基本信息",-1)),a(A,{column:2,border:""},{default:n(()=>[a(f,{label:"订单号"},{default:n(()=>[c(u(t.currentOrder.order_id),1)]),_:1}),a(f,{label:"下单时间"},{default:n(()=>[c(u(t.formatDateTime(t.currentOrder.created_at)),1)]),_:1}),a(f,{label:"餐厅"},{default:n(()=>[c(u(t.currentOrder.canteen),1)]),_:1}),a(f,{label:"窗口"},{default:n(()=>[c(u(t.currentOrder.window),1)]),_:1}),a(f,{label:"就餐方式"},{default:n(()=>[c(u(t.currentOrder.meal_type==="dine_in"?"堂食":"打包"),1)]),_:1}),a(f,{label:"订单状态"},{default:n(()=>[a(x,{type:t.getStatusType(t.currentOrder.status)},{default:n(()=>[c(u(t.getStatusText(t.currentOrder.status)),1)]),_:1},8,["type"])]),_:1})]),_:1})]),s("div",Ve,[l[15]||(l[15]=s("h4",null,"菜品信息",-1)),a(R,{data:t.currentOrder.dishes,border:""},{default:n(()=>[a(_,{prop:"name",label:"菜品名称"}),a(_,{prop:"price",label:"单价"},{default:n(({row:e})=>[c("¥"+u(e.price.toFixed(2)),1)]),_:1}),a(_,{prop:"quantity",label:"数量",width:"100"}),a(_,{label:"小计",width:"120"},{default:n(({row:e})=>[c(" ¥"+u((e.price*e.quantity).toFixed(2)),1)]),_:1})]),_:1},8,["data"]),s("div",Fe,[l[14]||(l[14]=c(" 总计：")),s("span",ze,"¥"+u(t.currentOrder.total_amount.toFixed(2)),1)])]),s("div",Te,[l[16]||(l[16]=s("h4",null,"备注信息",-1)),s("p",qe,u(t.currentOrder.remark||"无"),1)])])):ce("",!0)]),_:1},8,["modelValue"])])}const Ye=K(me,[["render",Re],["__scopeId","data-v-b9a83364"]]);export{Ye as default};
