import{_ as oe,M as le,ak as se,U as ie,g as i,h as F,Y as Q,o as de,k as T,n as r,q as e,w as o,E as w,af as re,x as c,y as b,B as h,I as z,a1 as J,z as O,v as k,C as ce}from"./index-CjeFGtzt.js";import{h as Z}from"./request-Coerp45x.js";const ue={name:"MenuManagement",components:{Plus:le,Edit:se,Search:ie},setup(){const Y=[{id:1,name:"红烧肉",category:"热菜",price:15,image_url:"https://example.com/dishes/hongshaorou.jpg",stock:50,description:"经典红烧肉，肥而不腻"},{id:2,name:"清炒时蔬",category:"素菜",price:8,image_url:"https://example.com/dishes/qingcao.jpg",stock:100,description:"新鲜时令蔬菜"},{id:3,name:"番茄蛋汤",category:"汤品",price:6,image_url:"https://example.com/dishes/fanqiedantang.jpg",stock:80,description:"营养美味的番茄蛋汤"}],a=[{id:1,name:"中央食堂",floors:3,location:"校园中心区"},{id:2,name:"沁园餐厅",floors:2,location:"学生宿舍区"},{id:3,name:"馨园餐厅",floors:1,location:"教学区"},{id:4,name:"仲园餐厅",floors:2,location:"图书馆附近"},{id:5,name:"雅园餐厅",floors:1,location:"体育馆附近"},{id:6,name:"A区服务点",floors:1,location:"A区教学楼"},{id:7,name:"F区服务点",floors:1,location:"F区教学楼"}],B=[{id:101,name:"一楼-大荤窗口",location:"中央食堂一楼左",operatingHours:"10:30-13:30, 16:30-19:00",canteen:"中央食堂"},{id:102,name:"一楼-特色炒菜",location:"中央食堂一楼右",operatingHours:"10:30-13:30, 16:30-19:00",canteen:"中央食堂"},{id:201,name:"一楼-快餐窗口",location:"沁园餐厅一楼",operatingHours:"10:30-13:30, 16:30-19:00",canteen:"沁园餐厅"},{id:601,name:"A区-快餐窗口",location:"A区教学楼一楼",operatingHours:"10:30-13:30, 16:30-19:00",canteen:"A区服务点"},{id:602,name:"A区-饮品店",location:"A区教学楼一楼",operatingHours:"08:00-20:00",canteen:"A区服务点"},{id:701,name:"F区-快餐窗口",location:"F区教学楼一楼",operatingHours:"10:30-13:30, 16:30-19:00",canteen:"F区服务点"},{id:702,name:"F区-饮品店",location:"F区教学楼一楼",operatingHours:"08:00-20:00",canteen:"F区服务点"}],t=[{id:1,window_id:101,date:"2024-03-17",dishes:[{id:1,name:"红烧肉",price:15,stock:50},{id:2,name:"清炒时蔬",price:8,stock:100}]},{id:2,window_id:102,date:"2024-03-17",dishes:[{id:3,name:"番茄蛋汤",price:6,stock:80}]}],D=i(new Date),R=i([]),g=i(null),y=i(!1),u=i(!1),H=i(a),f=i(t),C=i(B),V=i(Y),d=i([]),v=i(!1);i(!1);const x=i(""),M=i(""),P=["主食","大荤","小荤","素菜","汤品","特色炒菜","面食","饮品","水果","小吃"];F({stock:0,dishId:null});const E=Q(()=>C.value.filter(n=>n.canteen===K.value)),I=Q(()=>V.value.filter(n=>{const s=n.name.toLowerCase().includes(x.value.toLowerCase()),p=!M.value||n.category===M.value;return s&&p})),S=async n=>{try{await new Promise(s=>setTimeout(s,500)),f.value=t,y.value=t.length>0}catch{w.error("获取菜单数据失败")}},U=n=>{if(!ne(n.id)){w.warning("您没有权限编辑此窗口的菜单");return}g.value=n,d.value=W(n.id),v.value=!0},W=n=>{const s=f.value.find(p=>p.window_id===n);return s?s.dishes:[]},j=n=>{const s=n.filter(p=>!d.value.some(ae=>ae.id===p.id));d.value.push(...s)},N=n=>{const s=d.value.findIndex(p=>p.id===n.id);s>-1&&d.value.splice(s,1)},q=async()=>{try{u.value=!0,await _({window_id:g.value.id,date:D.value,dishes:d.value.map(n=>n.id)}),w.success("菜单存成功"),v.value=!1,await l()}catch{w.error("菜单保存失败")}finally{u.value=!1}},L=async n=>{try{await re.confirm(`确定要从菜单中移除 ${n.name} 吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await Z.delete(`/admin/menus/${g.value.id}/dishes/${n.id}`),w.success("移除成功"),await l()}catch(s){s!=="cancel"&&w.error("移除失败")}},A=n=>n.getTime()<Date.now()-864e5,l=async()=>{try{u.value=!0;const n=await Z.get("/admin/menus",{params:{date:D.value}});f.value=n.data}catch(n){console.error("获取菜单失败:",n),w.error("获取菜单数据失败，请稍后重试"),f.value=[]}finally{u.value=!1}},_=async n=>new Promise((s,p)=>{setTimeout(()=>{console.log("保存的菜单数据:",n),s({status:"success"})},1e3)});de(()=>{C.value=B,V.value=Y,f.value=t,S(D.value)});const m=()=>{g.value=null,d.value=[],v.value=!0},G=n=>{const s=new Date(n),p=["周日","周一","周二","周三","周四","周五","周六"];return`${s.getFullYear()}年${s.getMonth()+1}月${s.getDate()}日 ${p[s.getDay()]}`},$=n=>({主食:"",热菜:"success",凉菜:"info",汤品:"warning",饮品:"danger"})[n]||"info";i(""),i(!1),i(null),i(1),i(null),i(!1),i(null),F({中央食堂:{lunch:{start:"11:30",end:"12:30"},dinner:{start:"17:30",end:"18:30"}},沁园餐厅:{lunch:{start:"11:45",end:"12:45"},dinner:{start:"17:45",end:"18:45"}},馨园餐厅:{lunch:{start:"11:30",end:"12:30"},dinner:{start:"17:30",end:"18:30"}},仲园餐厅:{lunch:{start:"11:30",end:"12:30"},dinner:{start:"17:30",end:"18:30"}},雅园餐厅:{lunch:{start:"11:30",end:"12:30"},dinner:{start:"17:30",end:"18:30"}},服务点:{lunch:{start:"11:30",end:"12:30"},dinner:{start:"17:30",end:"18:30"}}}),F({crowdAlert:!0,crowdThreshold:80}),F({中央食堂:{current:65,max:100},沁园餐厅:{current:45,max:100}});const K=i("中央食堂"),ee=ce(),te=()=>{ee.push("/admin/dishes")},X=Q(()=>{const n=localStorage.getItem("verifiedInfo");return n?JSON.parse(n):null}),ne=n=>X.value?X.value.window.id===n:!1;return{selectedDate:D,activeWindows:R,activeCanteen:K,currentWindow:g,isPublished:y,loading:u,canteens:H,menus:f,windows:C,dishes:V,selectedDishes:d,dialogVisible:v,dishSearchQuery:x,dishCategoryFilter:M,categories:P,filteredWindows:E,filteredAvailableDishes:I,handleDateChange:S,editWindowMenu:U,getWindowDishes:W,handleSelectionChange:j,removeSelectedDish:N,removeDish:L,disabledDate:A,formatDate:G,getCategoryType:$,showAddDialog:m,goToDishManagement:te,saveWindowMenu:q}}},me={class:"menu-management"},_e={class:"top-actions"},pe={class:"left"},fe={class:"menu-content"},he={class:"canteen-header"},ge={class:"card-header"},ve={class:"header-title"},ye={class:"window-menus"},we={class:"window-menu"},be={class:"menu-header"},ke={class:"menu-time"},De={class:"menu-actions"},Ce={class:"dish-info"},Ve={class:"price"},Me={class:"dialog-content"},xe={class:"selected-dishes"},Se={class:"dish-selector"},We={class:"selector-filters"};function Ae(Y,a,B,t,D,R){var A;const g=c("Plus"),y=c("el-icon"),u=c("el-button"),H=c("el-date-picker"),f=c("el-tag"),C=c("Edit"),V=c("el-image"),d=c("el-table-column"),v=c("el-table"),x=c("el-collapse-item"),M=c("el-collapse"),P=c("el-card"),E=c("el-col"),I=c("el-row"),S=c("el-tab-pane"),U=c("el-tabs"),W=c("Search"),j=c("el-input"),N=c("el-option"),q=c("el-select"),L=c("el-dialog");return b(),T("div",me,[r("div",_e,[r("div",pe,[e(u,{type:"primary",onClick:t.showAddDialog},{default:o(()=>[e(y,null,{default:o(()=>[e(g)]),_:1}),a[7]||(a[7]=h("上传菜单 "))]),_:1},8,["onClick"]),e(H,{modelValue:t.selectedDate,"onUpdate:modelValue":a[0]||(a[0]=l=>t.selectedDate=l),type:"date",placeholder:"选择日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",onChange:t.handleDateChange,"disabled-date":t.disabledDate,class:"date-picker"},null,8,["modelValue","onChange","disabled-date"]),e(u,{type:"primary",plain:"",onClick:t.goToDishManagement},{default:o(()=>[e(y,null,{default:o(()=>[e(g)]),_:1}),a[8]||(a[8]=h(" 管理菜品库 "))]),_:1},8,["onClick"])])]),r("div",fe,[e(U,{modelValue:t.activeCanteen,"onUpdate:modelValue":a[2]||(a[2]=l=>t.activeCanteen=l),type:"card",class:"canteen-tabs"},{default:o(()=>[(b(!0),T(z,null,J(t.canteens,l=>(b(),O(S,{key:l.id,label:l.name,name:l.name},{default:o(()=>[r("div",he,[r("h3",null,k(l.name),1)]),e(I,{gutter:20},{default:o(()=>[e(E,{span:24},{default:o(()=>[e(P,{class:"menu-card"},{header:o(()=>[r("div",ge,[r("span",ve,k(t.formatDate(t.selectedDate||new Date))+" 菜单安排 ",1),e(f,{type:"success",effect:"dark",class:"status-tag"},{default:o(()=>[h(k(t.isPublished?"已发布":"未发布"),1)]),_:1})])]),default:o(()=>[r("div",ye,[e(M,{modelValue:t.activeWindows,"onUpdate:modelValue":a[1]||(a[1]=_=>t.activeWindows=_)},{default:o(()=>[(b(!0),T(z,null,J(t.filteredWindows,_=>(b(),O(x,{key:_.id,title:_.name,name:_.id},{default:o(()=>[r("div",we,[r("div",be,[r("div",ke,"营业时间："+k(_.operatingHours),1),r("div",De,[e(u,{type:"primary",link:"",onClick:m=>t.editWindowMenu(_)},{default:o(()=>[e(y,null,{default:o(()=>[e(C)]),_:1}),a[9]||(a[9]=h("编辑菜单 "))]),_:2},1032,["onClick"])])]),e(v,{data:t.getWindowDishes(_.id),style:{width:"100%"},"header-cell-style":{background:"#f5f7fa"}},{default:o(()=>[e(d,{prop:"name",label:"菜品名称"},{default:o(({row:m})=>[r("div",Ce,[e(V,{src:m.image_url,"preview-src-list":[m.image_url],class:"dish-image"},null,8,["src","preview-src-list"]),r("span",null,k(m.name),1)])]),_:1}),e(d,{prop:"category",label:"类别",width:"120"},{default:o(({row:m})=>[e(f,{size:"small",type:t.getCategoryType(m.category)},{default:o(()=>[h(k(m.category),1)]),_:2},1032,["type"])]),_:1}),e(d,{prop:"price",label:"价格",width:"120"},{default:o(({row:m})=>[r("span",Ve,"¥"+k(m.price),1)]),_:1}),e(d,{label:"操作",width:"120",fixed:"right"},{default:o(({row:m})=>[e(u,{type:"danger",link:"",onClick:G=>t.removeDish(m)},{default:o(()=>a[10]||(a[10]=[h(" 移除 ")])),_:2},1032,["onClick"])]),_:1})]),_:2},1032,["data"])])]),_:2},1032,["title","name"]))),128))]),_:1},8,["modelValue"])])]),_:1})]),_:1})]),_:1})]),_:2},1032,["label","name"]))),128))]),_:1},8,["modelValue"])]),e(L,{title:`编辑${((A=t.currentWindow)==null?void 0:A.name)||""}菜单`,modelValue:t.dialogVisible,"onUpdate:modelValue":a[6]||(a[6]=l=>t.dialogVisible=l),width:"60%"},{footer:o(()=>[e(u,{onClick:a[5]||(a[5]=l=>t.dialogVisible=!1)},{default:o(()=>a[14]||(a[14]=[h("取消")])),_:1}),e(u,{type:"primary",onClick:t.saveWindowMenu,loading:t.loading},{default:o(()=>a[15]||(a[15]=[h(" 保存菜单 ")])),_:1},8,["onClick","loading"])]),default:o(()=>[r("div",Me,[r("div",xe,[a[12]||(a[12]=r("h4",null,"已选菜品",-1)),e(v,{data:t.selectedDishes,style:{width:"100%"}},{default:o(()=>[e(d,{prop:"name",label:"菜品名称"}),e(d,{prop:"category",label:"类别",width:"120"}),e(d,{prop:"price",label:"价格",width:"120"}),e(d,{label:"操作",width:"120"},{default:o(({row:l})=>[e(u,{type:"danger",link:"",onClick:_=>t.removeSelectedDish(l)},{default:o(()=>a[11]||(a[11]=[h(" 移除 ")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),r("div",Se,[a[13]||(a[13]=r("h4",null,"添加菜品",-1)),r("div",We,[e(j,{modelValue:t.dishSearchQuery,"onUpdate:modelValue":a[3]||(a[3]=l=>t.dishSearchQuery=l),placeholder:"搜索菜品",clearable:"",class:"search-input"},{prefix:o(()=>[e(y,null,{default:o(()=>[e(W)]),_:1})]),_:1},8,["modelValue"]),e(q,{modelValue:t.dishCategoryFilter,"onUpdate:modelValue":a[4]||(a[4]=l=>t.dishCategoryFilter=l),placeholder:"菜品类别",clearable:""},{default:o(()=>[(b(!0),T(z,null,J(t.categories,l=>(b(),O(N,{key:l,label:l,value:l},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),e(v,{data:t.filteredAvailableDishes,style:{width:"100%"},height:"300",onSelectionChange:t.handleSelectionChange},{default:o(()=>[e(d,{type:"selection",width:"55"}),e(d,{prop:"name",label:"菜品名称"}),e(d,{prop:"category",label:"类别",width:"120"}),e(d,{prop:"price",label:"价格",width:"120"})]),_:1},8,["data","onSelectionChange"])])])]),_:1},8,["title","modelValue"])])}const Ye=oe(ue,[["render",Ae],["__scopeId","data-v-043e336d"]]);export{Ye as default};
