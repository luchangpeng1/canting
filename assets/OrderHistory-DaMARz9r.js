import{_ as Q,a7 as W,L as Y,g as c,V as Z,o as $,k as C,n as r,q as o,w as l,af as ee,z as x,A as U,H as E,X as H,E as k,ad as te,x as i,ag as ne,y as _,B as u,v as f,C as ae}from"./index-eMRJYRn7.js";import"./request-C5bOnPyA.js";const oe={name:"OrderHistory",components:{ArrowLeft:W,Plus:Y},setup(){const b=ae(),e=c(!1),D=c("all"),t=c(null),w=c(1),S=c(10),V=c(0),h=c([]),m=c(!1),g=c(null),R=c(null),v=c({rating:0,content:"",images:[]}),T={rating:[{required:!0,message:"请给出评分",trigger:"change"}],content:[{required:!0,message:"请填写评价内容",trigger:"blur"},{min:10,message:"评价内容至少10���字",trigger:"blur"}]},O=[{text:"最近一周",value:()=>{const n=new Date,s=new Date;return s.setTime(s.getTime()-3600*1e3*24*7),[s,n]}},{text:"最近一个月",value:()=>{const n=new Date,s=new Date;return s.setTime(s.getTime()-3600*1e3*24*30),[s,n]}},{text:"最近三个月",value:()=>{const n=new Date,s=new Date;return s.setTime(s.getTime()-3600*1e3*24*90),[s,n]}}],z=Z(()=>{let n=[...h.value];if(D.value!=="all"&&(n=n.filter(s=>s.status===D.value)),t.value){const[s,J]=t.value;n=n.filter(K=>{const j=new Date(K.createTime);return j>=s&&j<=J})}return n}),p=async()=>{e.value=!0;try{h.value=[{id:1,orderNumber:"ORD202403150001",createTime:"2024-03-15 12:30:00",status:"completed",totalAmount:45,dishes:[{id:1,name:"宫保鸡丁",price:15,quantity:2,image_url:"https://example.com/dish1.jpg"},{id:2,name:"麻婆豆腐",price:15,quantity:1,image_url:"https://example.com/dish2.jpg"}]},{id:2,orderNumber:"ORD202403150002",createTime:"2024-03-15 18:45:00",status:"pending",totalAmount:32,dishes:[{id:3,name:"青椒肉丝",price:16,quantity:2,image_url:"https://example.com/dish3.jpg"}]}],V.value=2}catch(n){console.error("获取订单列表失败:",n),k.error("获取订单列表失败")}finally{e.value=!1}},F=n=>({pending:"待处理",processing:"处理中",completed:"已完成",cancelled:"已取消"})[n]||n,B=n=>({pending:"warning",processing:"primary",completed:"success",cancelled:"info"})[n]||"",y=()=>{w.value=1,p()},q=()=>{w.value=1,p()},A=n=>{w.value=n,p()},L=n=>{S.value=n,w.value=1,p()},M=n=>{b.push(`/student/orders/${n.id}`)},N=n=>{b.push(`/student/dishes/${n}`)},P=async n=>{try{await te.confirm("确定要取消这个订单吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),k.success("订单已取消"),p()}catch(s){s!=="cancel"&&(console.error("取消订单失败:",s),k.error("取消订单失败"))}},a=n=>{R.value=n,v.value={rating:0,content:"",images:[]},m.value=!0},d=n=>{v.value.images.push(n.raw)},I=n=>{const s=v.value.images.indexOf(n.raw);s>-1&&v.value.images.splice(s,1)},X=async()=>{if(g.value)try{await g.value.validate(),k.success("评价提交成功"),m.value=!1,p()}catch(n){n!=="cancel"&&(console.error("提交评价失败:",n),k.error("提交评价失败"))}},G=()=>{b.back()};return $(()=>{p()}),{loading:e,filterStatus:D,dateRange:t,dateShortcuts:O,currentPage:w,pageSize:S,total:V,filteredOrders:z,reviewDialogVisible:m,reviewForm:v,reviewFormRef:g,reviewRules:T,handleFilterChange:y,handleDateChange:q,handleCurrentChange:A,handleSizeChange:L,getStatusLabel:F,getStatusType:B,viewOrderDetail:M,viewDishDetail:N,cancelOrder:P,writeReview:a,handleImageChange:d,handleImageRemove:I,submitReview:X,goBack:G}}},le={class:"order-history"},se={class:"back-button"},re={class:"back-content"},ie={class:"filter-section"},de={class:"orders-list"},ce={class:"order-header"},ue={class:"order-info"},me={class:"order-number"},ge={class:"order-time"},pe={class:"order-content"},_e={class:"dish-list"},ve={class:"dish-info"},fe={class:"dish-name"},we={class:"dish-price"},he={class:"order-footer"},ye={class:"order-total"},Ce={class:"total-amount"},ke={class:"order-actions"},be={class:"pagination-container"};function De(b,e,D,t,w,S){const V=i("ArrowLeft"),h=i("el-icon"),m=i("el-button"),g=i("el-radio-button"),R=i("el-radio-group"),v=i("el-date-picker"),T=i("el-empty"),O=i("el-tag"),z=i("el-image"),p=i("el-card"),F=i("el-pagination"),B=i("el-rate"),y=i("el-form-item"),q=i("el-input"),A=i("Plus"),L=i("el-upload"),M=i("el-form"),N=i("el-dialog"),P=ne("loading");return _(),C("div",le,[r("div",se,[o(m,{onClick:t.goBack,class:"custom-back-btn",link:""},{default:l(()=>[r("div",re,[o(h,{class:"back-icon"},{default:l(()=>[o(V)]),_:1}),e[8]||(e[8]=r("span",{class:"back-text"},"返回上一页",-1))])]),_:1},8,["onClick"])]),r("div",ie,[o(R,{modelValue:t.filterStatus,"onUpdate:modelValue":e[0]||(e[0]=a=>t.filterStatus=a),onChange:t.handleFilterChange},{default:l(()=>[o(g,{label:"all"},{default:l(()=>e[9]||(e[9]=[u("全部订单")])),_:1}),o(g,{label:"pending"},{default:l(()=>e[10]||(e[10]=[u("待处理")])),_:1}),o(g,{label:"processing"},{default:l(()=>e[11]||(e[11]=[u("处理中")])),_:1}),o(g,{label:"completed"},{default:l(()=>e[12]||(e[12]=[u("已完成")])),_:1}),o(g,{label:"cancelled"},{default:l(()=>e[13]||(e[13]=[u("已取消")])),_:1})]),_:1},8,["modelValue","onChange"]),o(v,{modelValue:t.dateRange,"onUpdate:modelValue":e[1]||(e[1]=a=>t.dateRange=a),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",onChange:t.handleDateChange,shortcuts:t.dateShortcuts,class:"date-picker"},null,8,["modelValue","onChange","shortcuts"])]),ee((_(),C("div",de,[t.filteredOrders.length?U("",!0):(_(),x(T,{key:0,description:"暂无订单记录"})),(_(!0),C(E,null,H(t.filteredOrders,a=>(_(),x(p,{key:a.id,class:"order-card"},{default:l(()=>[r("div",ce,[r("div",ue,[r("span",me,"订单号："+f(a.orderNumber),1),r("span",ge,f(a.createTime),1)]),o(O,{type:t.getStatusType(a.status),class:"status-tag"},{default:l(()=>[u(f(t.getStatusLabel(a.status)),1)]),_:2},1032,["type"])]),r("div",pe,[r("div",_e,[(_(!0),C(E,null,H(a.dishes,d=>(_(),C("div",{key:d.id,class:"dish-item"},[o(z,{src:d.image_url,alt:d.name,class:"dish-image",onClick:I=>t.viewDishDetail(d.id)},{error:l(()=>e[14]||(e[14]=[r("div",{class:"image-placeholder"},"暂无图片",-1)])),_:2},1032,["src","alt","onClick"]),r("div",ve,[r("h4",fe,f(d.name),1),r("p",we,"¥"+f(d.price)+" × "+f(d.quantity),1)])]))),128))]),r("div",he,[r("div",ye,[e[15]||(e[15]=r("span",{class:"total-label"},"总计：",-1)),r("span",Ce,"¥"+f(a.totalAmount),1)]),r("div",ke,[a.status==="completed"?(_(),x(m,{key:0,type:"primary",link:"",onClick:d=>t.writeReview(a)},{default:l(()=>e[16]||(e[16]=[u(" 写评价 ")])),_:2},1032,["onClick"])):U("",!0),a.status==="pending"?(_(),x(m,{key:1,type:"danger",link:"",onClick:d=>t.cancelOrder(a)},{default:l(()=>e[17]||(e[17]=[u(" 取消订单 ")])),_:2},1032,["onClick"])):U("",!0),o(m,{type:"primary",link:"",onClick:d=>t.viewOrderDetail(a)},{default:l(()=>e[18]||(e[18]=[u(" 查看详情 ")])),_:2},1032,["onClick"])])])])]),_:2},1024))),128))])),[[P,t.loading]]),r("div",be,[o(F,{"current-page":t.currentPage,"onUpdate:currentPage":e[2]||(e[2]=a=>t.currentPage=a),"page-size":t.pageSize,"onUpdate:pageSize":e[3]||(e[3]=a=>t.pageSize=a),total:t.total,"page-sizes":[10,20,30,50],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:t.handleSizeChange,onCurrentChange:t.handleCurrentChange},null,8,["current-page","page-size","total","onSizeChange","onCurrentChange"])]),o(N,{modelValue:t.reviewDialogVisible,"onUpdate:modelValue":e[7]||(e[7]=a=>t.reviewDialogVisible=a),title:"写评价",width:"50%"},{footer:l(()=>[o(m,{onClick:e[6]||(e[6]=a=>t.reviewDialogVisible=!1)},{default:l(()=>e[19]||(e[19]=[u("取消")])),_:1}),o(m,{type:"primary",onClick:t.submitReview},{default:l(()=>e[20]||(e[20]=[u("提交评价")])),_:1},8,["onClick"])]),default:l(()=>[o(M,{model:t.reviewForm,rules:t.reviewRules,ref:"reviewFormRef"},{default:l(()=>[o(y,{label:"评分",prop:"rating"},{default:l(()=>[o(B,{modelValue:t.reviewForm.rating,"onUpdate:modelValue":e[4]||(e[4]=a=>t.reviewForm.rating=a),"show-score":""},null,8,["modelValue"])]),_:1}),o(y,{label:"评价内容",prop:"content"},{default:l(()=>[o(q,{type:"textarea",modelValue:t.reviewForm.content,"onUpdate:modelValue":e[5]||(e[5]=a=>t.reviewForm.content=a),rows:4,placeholder:"请分享您的用餐体验..."},null,8,["modelValue"])]),_:1}),o(y,{label:"上传图片"},{default:l(()=>[o(L,{action:"#","list-type":"picture-card","auto-upload":!1,"on-change":t.handleImageChange,"on-remove":t.handleImageRemove},{default:l(()=>[o(h,null,{default:l(()=>[o(A)]),_:1})]),_:1},8,["on-change","on-remove"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])])}const Se=Q(oe,[["render",De],["__scopeId","data-v-4c8abf54"]]);export{Se as default};
