import{_ as E,a7 as P,U as H,L as J,g as f,h as X,V as G,ae as K,o as Q,k as b,n as t,q as a,w as o,E as p,x as i,y as c,v as n,B as d,z as A,A as L,I as W,H as S,X as B,J as Y,C as Z}from"./index-eMRJYRn7.js";import"./request-C5bOnPyA.js";const $={name:"DishDetail",components:{ArrowLeft:P,ShoppingCart:H,Plus:J},setup(){const F=Y(),e=Z(),T=f({}),s=f(!1),y=f(null),_=f([]),g=f(0),v=X({reservedTime:"",mealType:"dine_in",quantity:1}),m={reservedTime:[{required:!0,message:"请选择就餐时间",trigger:"change"}],mealType:[{required:!0,message:"请选择就餐方式",trigger:"change"}],quantity:[{required:!0,message:"请选择数量",trigger:"change"}]},k=G(()=>Number(g.value)),x=async()=>{try{const l={id:F.params.id,name:"测试菜品",price:15,description:"这是一道美味的测试菜品",category:"测试分类",taste:"spicy",image_url:"https://example.com/test.jpg",stock:10};T.value=l}catch(l){console.error("获取菜品详情失败:",l),p.error("获取菜品详情失败")}},C=async()=>{try{_.value=[{id:1,userName:"张三",userAvatar:"https://example.com/avatar1.jpg",rating:5,content:"这道菜非常美味，下次还会再来！食材新鲜，配料搭配得当，特别是那个酱料，绝了！",createTime:"2024-03-15 12:30",images:["https://example.com/review1-1.jpg","https://example.com/review1-2.jpg"]},{id:2,userName:"李四",userAvatar:"https://example.com/avatar2.jpg",rating:4,content:"味道不错，就是份量稍微少了点。服务态度很好，上菜速度快。",createTime:"2024-03-14 18:45"},{id:3,userName:"小王",userAvatar:"https://example.com/avatar3.jpg",rating:5,content:"学校食堂能有这样的水准真是太棒了！价格实惠，味道地道，特别推荐！",createTime:"2024-03-14 12:15",images:["https://example.com/review3.jpg"]},{id:4,userName:"美食达人",userAvatar:"https://example.com/avatar4.jpg",rating:3,content:"整体来说还可以，不过感觉调味可以再改进一下，稍微有点咸。希望厨师能够根据建议改进。",createTime:"2024-03-13 19:20"},{id:5,userName:"校园吃货",userAvatar:"https://example.com/avatar5.jpg",rating:5,content:"这道菜绝对是食堂的招牌！每次来都必点，从来没有失望过。食材的搭配很用心，摆盘也很精致。",createTime:"2024-03-13 13:40",images:["https://example.com/review5-1.jpg","https://example.com/review5-2.jpg","https://example.com/review5-3.jpg"]},{id:6,userName:"小林",userAvatar:"https://example.com/avatar6.jpg",rating:4,content:"作为学校食堂的菜品来说已经很不错了，性价比很高。建议可以考虑推出套餐搭配。",createTime:"2024-03-12 17:55"},{id:7,userName:"美食评论家",userAvatar:"https://example.com/avatar7.jpg",rating:5,content:"这道菜的口感层次非常丰富，能吃出厨师的用心。特别是酱料的调配很有特色，为整道菜增色不少。强烈推荐大家尝试！",createTime:"2024-03-12 12:10",images:["https://example.com/review7-1.jpg","https://example.com/review7-2.jpg"]},{id:8,userName:"老顾客",userAvatar:"https://example.com/avatar8.jpg",rating:4,content:"连续点了好多次了，味道一直保持得很稳定。希望能保持这个水准，继续做下去！",createTime:"2024-03-11 18:30"}];const l=_.value.reduce((h,u)=>h+u.rating,0);g.value=(l/_.value.length).toFixed(1)}catch(l){console.error("获取评价失败:",l),p.error("获取评价失败")}},j=async()=>{if(y.value)try{await y.value.validate(),p.success("预订成功"),s.value=!1,e.push("/student/orders")}catch(l){console.error("预订失败:",l),p.error("预订失败")}},w=async()=>{try{p.success("已添加到购物车")}catch(l){console.error("添加购物车失败:",l),p.error("添加购物车失败")}},V=l=>({spicy:"麻辣",light:"清淡",sweet:"甜味",savory:"咸鲜"})[l]||l;K((l,h,u)=>{l.name==="DishList"&&localStorage.setItem("isReturningFromDetail","true"),u()});const D=()=>{localStorage.setItem("isReturningFromDetail","true"),e.back()};return Q(()=>{x(),C()}),{dish:T,orderDialogVisible:s,orderForm:v,orderFormRef:y,orderRules:m,showOrderDialog:()=>{s.value=!0},submitOrder:j,addToCart:w,getTasteLabel:V,goBack:D,reviews:_,averageRating:g,ratingValue:k}}},ee={class:"dish-detail"},se={class:"back-button"},te={class:"back-content"},ae={class:"dish-banner"},oe={class:"banner-overlay"},re={class:"dish-title"},le={class:"tags"},ie={class:"info-section"},ne={class:"price-section"},de={class:"price-amount"},ce={class:"sales-grid"},me={class:"sales-item"},ue={class:"sales-number"},pe={class:"sales-item"},_e={class:"sales-number"},ge={class:"sales-item"},ve={class:"sales-number"},he={class:"description-box"},fe={class:"description-text"},be={class:"action-buttons"},ye={class:"reviews-header"},ke={class:"review-stats"},xe={class:"rating"},we={class:"review-count"},Ve={class:"reviews-list"},Te={class:"review-header"},Ce={class:"review-user-info"},je={class:"user-name"},De={class:"review-time"},Ne={class:"review-content"},Ae={key:0,class:"review-images"};function Fe(F,e,T,s,y,_){const g=i("ArrowLeft"),v=i("el-icon"),m=i("el-button"),k=i("el-image"),x=i("el-tag"),C=i("ShoppingCart"),j=i("Plus"),w=i("el-card"),V=i("el-rate"),D=i("el-empty"),l=i("el-avatar"),h=i("el-time-select"),u=i("el-form-item"),R=i("el-radio"),U=i("el-radio-group"),z=i("el-input-number"),I=i("el-form"),M=i("el-dialog");return c(),b("div",ee,[t("div",se,[a(m,{onClick:s.goBack,class:"custom-back-btn",link:""},{default:o(()=>[t("div",te,[a(v,{class:"back-icon"},{default:o(()=>[a(g)]),_:1}),e[6]||(e[6]=t("span",{class:"back-text"},"返回上一页",-1))])]),_:1},8,["onClick"])]),a(w,{class:"main-card","body-style":{padding:"0px"}},{default:o(()=>[t("div",ae,[a(k,{src:s.dish.image_url,alt:s.dish.name,fit:"cover",class:"banner-image"},{error:o(()=>e[7]||(e[7]=[t("div",{class:"image-placeholder"},"暂无图片",-1)])),_:1},8,["src","alt"]),t("div",oe,[t("h1",re,n(s.dish.name),1),t("div",le,[a(x,{effect:"dark",class:"tag-item"},{default:o(()=>[d(n(s.dish.category),1)]),_:1}),s.dish.taste?(c(),A(x,{key:0,type:"success",effect:"dark",class:"tag-item"},{default:o(()=>[d(n(s.getTasteLabel(s.dish.taste)),1)]),_:1})):L("",!0)])])]),t("div",ie,[t("div",ne,[e[8]||(e[8]=t("span",{class:"price-symbol"},"¥",-1)),t("span",de,n(s.dish.price),1),t("span",{class:W(["stock-tag",{"out-of-stock":s.dish.stock===0}])},n(s.dish.stock>0?`库存: ${s.dish.stock}`:"已售罄"),3)]),t("div",ce,[t("div",me,[t("div",ue,n(s.dish.monthSales||0),1),e[9]||(e[9]=t("div",{class:"sales-label"},"月销量",-1))]),e[12]||(e[12]=t("div",{class:"sales-divider"},null,-1)),t("div",pe,[t("div",_e,n(s.dish.weekSales||0),1),e[10]||(e[10]=t("div",{class:"sales-label"},"周销量",-1))]),e[13]||(e[13]=t("div",{class:"sales-divider"},null,-1)),t("div",ge,[t("div",ve,n(s.dish.daySales||0),1),e[11]||(e[11]=t("div",{class:"sales-label"},"日销量",-1))])]),t("div",he,[t("p",fe,n(s.dish.description),1)]),t("div",be,[a(m,{type:"primary",class:"order-btn",onClick:s.showOrderDialog,disabled:s.dish.stock===0},{default:o(()=>[a(v,null,{default:o(()=>[a(C)]),_:1}),e[14]||(e[14]=d(" 立即预订 "))]),_:1},8,["onClick","disabled"]),a(m,{type:"success",class:"cart-btn",onClick:s.addToCart,disabled:s.dish.stock===0},{default:o(()=>[a(v,null,{default:o(()=>[a(j)]),_:1}),e[15]||(e[15]=d(" 加入购物车 "))]),_:1},8,["onClick","disabled"])])])]),_:1}),a(w,{class:"reviews-card"},{header:o(()=>[t("div",ye,[e[16]||(e[16]=t("h3",{class:"section-title"},"用户评价",-1)),t("div",ke,[t("span",xe,n(s.averageRating),1),a(V,{modelValue:s.ratingValue,"onUpdate:modelValue":e[0]||(e[0]=r=>s.ratingValue=r),disabled:"","show-score":"","text-color":"#ff9900","score-template":""},null,8,["modelValue"]),t("span",we,"("+n(s.reviews.length)+"条评价)",1)])])]),default:o(()=>[t("div",Ve,[s.reviews.length?(c(!0),b(S,{key:1},B(s.reviews,r=>{var q;return c(),b("div",{key:r.id,class:"review-item"},[t("div",Te,[a(l,{size:50,src:r.userAvatar,class:"user-avatar"},{default:o(()=>[d(n(r.userName.charAt(0)),1)]),_:2},1032,["src"]),t("div",Ce,[t("span",je,n(r.userName),1),a(V,{modelValue:r.rating,"onUpdate:modelValue":N=>r.rating=N,disabled:"","show-score":"","text-color":"#ff9900"},null,8,["modelValue","onUpdate:modelValue"]),t("span",De,n(r.createTime),1)])]),t("div",Ne,n(r.content),1),(q=r.images)!=null&&q.length?(c(),b("div",Ae,[(c(!0),b(S,null,B(r.images,(N,O)=>(c(),A(k,{key:O,src:N,"preview-src-list":r.images,fit:"cover",class:"review-image"},null,8,["src","preview-src-list"]))),128))])):L("",!0)])}),128)):(c(),A(D,{key:0,description:"暂无评价","image-size":200}))])]),_:1}),a(M,{title:"预订菜品",modelValue:s.orderDialogVisible,"onUpdate:modelValue":e[5]||(e[5]=r=>s.orderDialogVisible=r),width:"30%"},{footer:o(()=>[a(m,{onClick:e[4]||(e[4]=r=>s.orderDialogVisible=!1)},{default:o(()=>e[19]||(e[19]=[d("取消")])),_:1}),a(m,{type:"primary",onClick:s.submitOrder},{default:o(()=>e[20]||(e[20]=[d("确认预订")])),_:1},8,["onClick"])]),default:o(()=>[a(I,{model:s.orderForm,rules:s.orderRules,ref:"orderFormRef"},{default:o(()=>[a(u,{label:"就餐时间",prop:"reservedTime"},{default:o(()=>[a(h,{modelValue:s.orderForm.reservedTime,"onUpdate:modelValue":e[1]||(e[1]=r=>s.orderForm.reservedTime=r),"picker-options":{start:"10:30",step:"00:15",end:"20:00"},placeholder:"选择就餐时间"},null,8,["modelValue"])]),_:1}),a(u,{label:"就餐方式",prop:"mealType"},{default:o(()=>[a(U,{modelValue:s.orderForm.mealType,"onUpdate:modelValue":e[2]||(e[2]=r=>s.orderForm.mealType=r)},{default:o(()=>[a(R,{label:"dine_in"},{default:o(()=>e[17]||(e[17]=[d("堂食")])),_:1}),a(R,{label:"take_out"},{default:o(()=>e[18]||(e[18]=[d("打包")])),_:1})]),_:1},8,["modelValue"])]),_:1}),a(u,{label:"数量",prop:"quantity"},{default:o(()=>[a(z,{modelValue:s.orderForm.quantity,"onUpdate:modelValue":e[3]||(e[3]=r=>s.orderForm.quantity=r),min:1,max:s.dish.stock,step:1},null,8,["modelValue","max"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])])}const Le=E($,[["render",Fe],["__scopeId","data-v-5ba5ac1c"]]);export{Le as default};
